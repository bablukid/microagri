<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

use \db\Chapitre as DbChapitre;
use \php\Boot;
use \haxe\CallStack;
use \db\Answer;
use \php\_Boot\HxString;
use \php\_Boot\HxException;
use \sugoi\form\Form;

class Hooks {
	/**
	 * @param DbChapitre $chapitre
	 * 
	 * @return void
	 */
	static public function beforeForm ($chapitre) {
		#src/Hooks.hx:7: characters 9-31
		$app = \App::$current;
		#src/Hooks.hx:10: lines 10-30
		if (($chapitre->order === 1) && ($chapitre->get_questionnaire()->id === 3)) {
			#src/Hooks.hx:12: characters 4-28
			$numResponsables = 1;
			#src/Hooks.hx:13: characters 13-71
			$n = \Std::parseInt(Answer::getAnswerOf("A5-1", $app->user));
			#src/Hooks.hx:14: lines 14-16
			if ($n !== null) {
				#src/Hooks.hx:15: characters 17-36
				$numResponsables = $n;
			}
			#src/Hooks.hx:18: characters 4-71
			if (Boot::dynamicField($app->session->data, 'respIndex') === null) {
				#src/Hooks.hx:18: characters 41-71
				$app->session->data->respIndex = 0;
			}
			#src/Hooks.hx:20: characters 13-72
			$nom_responsable = Answer::getAnswerOf("B1", $app->user);
			#src/Hooks.hx:21: characters 13-75
			$prenom_responsable = Answer::getAnswerOf("B2", $app->user);
			#src/Hooks.hx:23: lines 23-27
			if (($nom_responsable !== null) && ($prenom_responsable !== null) && ((HxString::split($prenom_responsable, "|")->arr[Boot::dynamicField($app->session->data, 'respIndex')] ?? null) !== null)) {
				#src/Hooks.hx:24: characters 29-82
				$tmp = "Responsable n°" . (\Std::string(Boot::dynamicField($app->session->data, 'respIndex') + 1)??'null') . " : ";
				#src/Hooks.hx:24: characters 5-199
				\App::$current->view->resp = ($tmp??'null') . ((HxString::split($prenom_responsable, "|")->arr[Boot::dynamicField($app->session->data, 'respIndex')] ?? null)??'null') . " " . ((HxString::split($nom_responsable, "|")->arr[Boot::dynamicField($app->session->data, 'respIndex')] ?? null)??'null');
			} else {
				#src/Hooks.hx:26: characters 46-76
				$tmp1 = \Std::string(Boot::dynamicField($app->session->data, 'respIndex') + 1);
				#src/Hooks.hx:26: characters 5-76
				\App::$current->view->resp = "Responsable n°" . ($tmp1??'null');
			}
		}
	}

	/**
	 * @param \Array_hx $questions
	 * 
	 * @return void
	 */
	static public function beforeFormBuild ($questions) {
		#src/Hooks.hx:37: lines 37-49
		$_g = 0;
		$_g1 = (clone $questions);
		while ($_g < $_g1->length) {
			#src/Hooks.hx:37: characters 14-15
			$q = ($_g1->arr[$_g] ?? null);
			#src/Hooks.hx:37: lines 37-49
			++$_g;
			#src/Hooks.hx:38: lines 38-48
			if ($q->ref === "D1-6") {
				#src/Hooks.hx:39: lines 39-47
				try {
					#src/Hooks.hx:40: characters 21-76
					$a = Answer::getAnswerOf("A6-1", \App::$current->user);
					#src/Hooks.hx:41: lines 41-46
					if ($a !== null) {
						#src/Hooks.hx:42: lines 42-45
						if (HxString::indexOf($a, "transformation") === -1) {
							#src/Hooks.hx:43: characters 29-48
							$questions->remove($q);
							#src/Hooks.hx:44: characters 29-34
							break;
						}
					}
				} catch (\Throwable $__hx__caught_e) {
					CallStack::saveExceptionTrace($__hx__caught_e);
					$__hx__real_e = ($__hx__caught_e instanceof HxException ? $__hx__caught_e->e : $__hx__caught_e);
					$e = $__hx__real_e;
									}
			}
		}
	}

	/**
	 * @param DbChapitre $chapitre
	 * @param Form $f
	 * @param \Array_hx $questions
	 * 
	 * @return void
	 */
	static public function onFormSubmit ($chapitre, $f, $questions) {
		#src/Hooks.hx:55: lines 55-84
		$_g = 0;
		while ($_g < $questions->length) {
			#src/Hooks.hx:55: characters 14-15
			$q = ($questions->arr[$_g] ?? null);
			#src/Hooks.hx:55: lines 55-84
			++$_g;
			#src/Hooks.hx:57: characters 20-25
			$__hx__switch = ($q->ref);
			if ($__hx__switch === "A2") {
				#src/Hooks.hx:60: characters 21-59
				$str = $f->getValueOf($q->ref);
				#src/Hooks.hx:61: lines 61-62
				if (($str !== null) && (HxString::indexOf($str, "33") === -1)) {
					#src/Hooks.hx:62: characters 25-30
					throw new HxException("Ce recensement concerne uniquement les fermes de Gironde, le code postal doit commencer par 33.");
				}
			} else if ($__hx__switch === "A5-1") {
				#src/Hooks.hx:66: characters 21-56
				$num = $f->getValueOf($q->ref);
				#src/Hooks.hx:67: characters 21-36
				if ($num > 6) {
					#src/Hooks.hx:67: characters 31-36
					throw new HxException("Vous ne pouvez pas définir plus de 6 responsables");
				}
			} else {
			}
		}
	}
}

Boot::registerClass(Hooks::class, 'Hooks');
