<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sugoi\i18n;

use \php\Boot;
use \haxe\CallStack;
use \sys\io\File;
use \haxe\ds\StringMap;
use \php\_Boot\HxException;

/**
 * @author tpfeiffer<thomas.pfeiffer@gmail.com>
 */
class Locale {
	/**
	 * @var StringMap
	 * Cache gettext objects in case of many language switches
	 * (like in a cron action which lead to send many emails in various languages)
	 */
	static public $cache;
	/**
	 * @var GetText
	 */
	static public $texts;

	/**
	 * @param string $lang
	 * 
	 * @return string
	 */
	static public function fileName ($lang) {
		#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:73: characters 3-36
		return "lang/texts_" . ($lang??'null') . ".mo";
	}

	/**
	 * @param string $lang
	 * @param \Closure $callback
	 * 
	 * @return GetText
	 */
	static public function init ($lang, $callback = null) {
		#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:53: characters 4-20
		$file = null;
		#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:54: lines 54-59
		try {
			#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:55: characters 5-75
			$file = File::getBytes((dirname($_SERVER["SCRIPT_FILENAME"])??'null') . "/" . "/" . (("lang/texts_" . ($lang??'null') . ".mo")??'null'));
		} catch (\Throwable $__hx__caught_e) {
			CallStack::saveExceptionTrace($__hx__caught_e);
			$__hx__real_e = ($__hx__caught_e instanceof HxException ? $__hx__caught_e->e : $__hx__caught_e);
			$e = $__hx__real_e;
			#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:58: characters 5-84
			\App::$current->session->addMessage("Cannot read translation file : " . (\Std::string($e)??'null'));
		}
		#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:60: characters 4-25
		Locale::$texts = new GetText();
		#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:61: characters 4-37
		if ($file !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:61: characters 19-37
			Locale::$texts->readMo($file);
		}
		#/home/bubar/projects/sugoi/src/sugoi/i18n/Locale.hx:64: characters 3-15
		return Locale::$texts;
	}

	/**
	 * @internal
	 * @access private
	 */
	static public function __hx__init ()
	{
		static $called = false;
		if ($called) return;
		$called = true;


		self::$cache = new StringMap();
	}
}

Boot::registerClass(Locale::class, 'sugoi.i18n.Locale');
Locale::__hx__init();
