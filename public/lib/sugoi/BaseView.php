<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sugoi;

use \sugoi\helper\Table;
use \php\_Boot\HxAnon;
use \php\Boot;
use \sugoi\db\File;
use \sugoi\db\Variable;
use \php\_Boot\HxString;
use \haxe\ds\List_hx;
use \haxe\ds\StringMap;
use \php\_Boot\HxException;
use \sugoi\i18n\Locale;

class BaseView {
	/**
	 * @var StringMap
	 */
	public $_vcache;

	/**
	 * @return mixed
	 */
	static public function init () {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:148: characters 3-25
		$view = new HxAnon();
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:149: characters 3-29
		$baseView = new \View();
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:150: lines 150-152
		$_g = 0;
		$_g1 = \Type::getInstanceFields(Boot::getClass(\View::class));
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:150: characters 7-12
			$field = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:150: lines 150-152
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:151: characters 4-62
			\Reflect::setField($view, $field, \Reflect::field($baseView, $field));
		}

		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:155: characters 3-30
		$view->LANG = \App::$config->LANG;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:156: characters 3-30
		$view->HOST = \App::$config->HOST;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:157: characters 3-40
		$view->DATA_HOST = \App::$config->DATA_HOST;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:158: characters 3-32
		$view->DEBUG = \App::$config->DEBUG;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:159: characters 3-30
		$view->NAME = \App::$config->NAME;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:162: characters 3-17
		$view->Std = Boot::getClass(\Std::class);
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:163: characters 3-19
		$view->Math = Boot::getClass(\Math::class);
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:169: characters 3-14
		return $view;
	}

	/**
	 * @return void
	 */
	public function __construct () {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:11: characters 3-22
		$this->_vcache = new StringMap();
	}

	/**
	 * @param string $str
	 * 
	 * @return string
	 */
	public function _ ($str) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:103: lines 103-107
		if (Locale::$texts !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:104: characters 4-43
			return Locale::$texts->get($str);
		} else {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:106: characters 4-14
			return $str;
		}
	}

	/**
	 * @param string $str
	 * @param mixed $params
	 * 
	 * @return string
	 */
	public function __ ($str, $params) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:112: characters 3-50
		return Locale::$texts->get($str, $params);
	}

	/**
	 * To safely print a string in javascript
	 * @param	str
	 * 
	 * @param string $str
	 * 
	 * @return string
	 */
	public function escapeJS ($str) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:53: characters 3-29
		if ($str === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:53: characters 20-29
			return "";
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:54: characters 3-109
		return HxString::split(HxString::split(HxString::split(HxString::split($str, "\\")->join("\\\\"), "'")->join("\\'"), "\x0D")->join("\\r"), "\x0A")->join("\\n");
	}

	/**
	 * Return the url of a db.File record
	 * 
	 * @param File $file
	 * 
	 * @return string
	 */
	public function file ($file) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:80: characters 3-26
		if ($file === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:80: characters 21-26
			throw new HxException("file is null");
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:81: characters 3-74
		return "/file/" . (File::makeSign($file->id)??'null') . "." . ($file->getExtension()??'null');
	}

	/**
	 * Get the latest message stored in session
	 * 
	 * @return object
	 */
	public function getMessage () {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:18: characters 3-37
		$session = \App::$current->session;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:19: characters 3-37
		if ($session === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:19: characters 26-37
			return null;
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:20: characters 3-44
		if ($session->get_messages() === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:20: characters 33-44
			return null;
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:21: characters 11-33
		$_this = $session->get_messages();
		if ($_this->length > 0) {
			$_this->length--;
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:21: characters 3-34
		$n = array_pop($_this->arr);
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:22: characters 3-30
		if ($n === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:22: characters 19-30
			return null;
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:23: characters 19-25
		$n1 = $n->text;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:23: characters 35-42
		$n2 = $n->error;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:23: characters 3-80
		return new HxAnon([
			"text" => $n1,
			"error" => $n2,
			"next" => $session->get_messages()->length > 0,
		]);
	}

	/**
	 * Get messages stored in session
	 * 
	 * @return \Array_hx
	 */
	public function getMessages () {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:30: characters 3-51
		$out = new \Array_hx();
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:31: characters 3-37
		$session = \App::$current->session;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:32: characters 3-35
		if ($session === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:32: characters 26-35
			return new \Array_hx();
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:33: characters 3-42
		if ($session->get_messages() === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:33: characters 33-42
			return new \Array_hx();
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:35: lines 35-38
		$_g = 0;
		$_g1 = $session->get_messages();
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:35: characters 9-10
			$m = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:35: lines 35-38
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:36: characters 4-28
			if ($m === null) {
				#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:36: characters 20-28
				continue;
			}
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:37: characters 4-50
			$out->arr[$out->length] = new HxAnon([
				"text" => $m->text,
				"error" => $m->error,
			]);
			++$out->length;

		}

		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:39: characters 3-24
		$session->set_messages(new \Array_hx());
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:40: characters 3-13
		return $out;
	}

	/**
	 * @param string $p
	 * 
	 * @return string
	 */
	public function getParam ($p) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:72: characters 3-64
		if ((\App::$current === null) || (\App::$current->params === null)) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:72: characters 53-64
			return null;
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:73: characters 10-35
		return (\App::$current->params->data[$p] ?? null);
	}

	/**
	 * Get a value from the Variable table
	 * 
	 * @param string $name
	 * 
	 * @return string
	 */
	public function getVariable ($name) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:62: characters 3-29
		$v = ($this->_vcache->data[$name] ?? null);
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:63: characters 3-27
		if ($v !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:63: characters 19-27
			return $v;
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:64: characters 3-39
		if (\App::$current->maintain) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:64: characters 30-39
			return "";
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:65: characters 3-25
		$v = Variable::get($name);
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:66: characters 3-25
		if ($v === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:66: characters 19-25
			$v = "";
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:67: characters 3-22
		$this->_vcache->data[$name] = $v;
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:68: characters 3-11
		return $v;
	}

	/**
	 * @param int $start
	 * @param int $end
	 * 
	 * @return List_hx
	 */
	public function loopList ($start, $end) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:137: characters 3-30
		$list = new List_hx();
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:138: lines 138-140
		$_g = $start;
		$_g1 = $end;
		while ($_g < $_g1) {
			$i = $_g++;
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:139: characters 4-15
			$list->add($i);
		}

		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:141: characters 3-14
		return $list;
	}

	/**
	 * newline to <br/>
	 * @param	txt
	 * 
	 * @param string $txt
	 * 
	 * @return string
	 */
	public function nl2br ($txt) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:97: characters 3-29
		if ($txt === null) {
			#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:97: characters 20-29
			return "";
		}
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:98: characters 3-39
		return HxString::split($txt, "\x0A")->join("<br/>");
	}

	/**
	 * Try to print an HTML table from any kind of object
	 * @param	data
	 * 
	 * @param mixed $data
	 * 
	 * @return string
	 */
	public function table ($data) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:89: characters 3-71
		return (new Table("table table-bordered"))->toString($data);
	}

	/**
	 * @param string $str
	 * 
	 * @return string
	 */
	public function urlEncode ($str) {
		#/home/bubar/projects/sugoi/src/sugoi/BaseView.hx:45: characters 3-36
		return rawurlencode($str);
	}
}

Boot::registerClass(BaseView::class, 'sugoi.BaseView');
