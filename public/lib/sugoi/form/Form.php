<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sugoi\form;

use \sugoi\form\elements\IntInput;
use \sugoi\form\elements\Submit;
use \php\_Boot\HxAnon;
use \sugoi\form\elements\ImageUpload;
use \sugoi\form\elements\DateDropdowns;
use \php\Boot;
use \sugoi\i18n\translator\ITranslator;
use \sugoi\form\elements\TextArea;
use \sugoi\form\elements\StringInput;
use \haxe\CallStack;
use \sugoi\form\elements\DateInput;
use \sys\db\Object_hx;
use \php\Web;
use \sugoi\form\elements\Enum;
use \sys\db\admin\TableInfos;
use \haxe\rtti\Meta;
use \sugoi\form\elements\CSRFProtection;
use \sugoi\form\elements\IntSelect;
use \sugoi\form\elements\FileUpload;
use \sugoi\form\elements\DatePicker;
use \haxe\ds\StringMap;
use \haxe\ds\List_hx;
use \sugoi\form\elements\Flags;
use \sugoi\form\elements\Checkbox;
use \sugoi\form\elements\FloatInput;
use \php\_Boot\HxException;
use \php\_NativeIndexedArray\NativeIndexedArrayIterator;
use \sugoi\form\elements\InputType;

class Form {
	/**
	 * @var bool
	 */
	static public $USE_DATEPICKER = true;
	/**
	 * @var bool
	 */
	static public $USE_TWITTER_BOOTSTRAP = true;
	/**
	 * @var ITranslator
	 */
	static public $translator;

	/**
	 * @var string
	 */
	public $action;
	/**
	 * @var bool
	 */
	public $autoGenSubmitButton;
	/**
	 * @var string
	 */
	public $defaultClass;
	/**
	 * @var \Array_hx
	 */
	public $elements;
	/**
	 * @var List_hx
	 */
	public $extraErrors;
	/**
	 * @var StringMap
	 */
	public $fieldsets;
	/**
	 * @var bool
	 */
	public $forcePopulate;
	/**
	 * @var string
	 */
	public $id;
	/**
	 * @var string
	 */
	public $invalidErrorClass;
	/**
	 * @var string
	 */
	public $labelRequiredIndicator;
	/**
	 * @var FormMethod
	 */
	public $method;
	/**
	 * @var bool
	 */
	public $multipart;
	/**
	 * @var string
	 */
	public $name;
	/**
	 * @var string
	 */
	public $requiredClass;
	/**
	 * @var string
	 */
	public $requiredErrorClass;
	/**
	 * @var FormElement
	 */
	public $submitButton;
	/**
	 * @var string
	 */
	public $submitButtonLabel;
	/**
	 * @var \Closure
	 */
	public $toString;

	/**
	 * Generate a form from any object
	 * @param	obj
	 * 
	 * @param mixed $obj
	 * 
	 * @return Form
	 */
	static public function fromObject ($obj) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:275: characters 3-34
		$form = new Form("fromObj");
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:276: lines 276-280
		$_g = 0;
		$_g1 = \Reflect::fields($obj);
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:276: characters 8-9
			$f = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:276: lines 276-280
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:277: characters 4-36
			$val = \Reflect::field($obj, $f);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:278: characters 4-29
			if ($val === "") {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:278: characters 19-29
				$val = null;
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:279: characters 4-67
			$form->addElement(new StringInput($f, $f, $val));
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:281: characters 3-14
		return $form;
	}

	/**
	 * @param Object_hx $obj
	 * 
	 * @return Form
	 */
	static public function fromSpod ($obj) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:290: characters 3-31
		$cl = \Type::getClass($obj);
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:291: characters 3-36
		$name = \Type::getClassName($cl);
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:293: characters 3-48
		$form = new Form("form" . (md5($name)??'null'));
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:294: characters 3-66
		$ti = new TableInfos(\Type::getClassName(\Type::getClass($obj)));
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:298: characters 3-36
		$t = new StringMap();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:299: lines 299-301
		if (\Reflect::hasField($cl, "getLabels")) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:300: characters 4-5
			$t = \Reflect::callMethod($cl, \Reflect::getProperty($cl, "getLabels"), new \Array_hx());
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:302: characters 3-73
		$label = function ($s)  use (&$t) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:302: characters 34-72
			if (($t->data[$s] ?? null) === null) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:302: characters 57-58
				return $s;
			} else {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:302: characters 64-72
				return ($t->data[$s] ?? null);
			}
		};
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:305: characters 3-60
		$metas = Meta::getFields(\Type::getClass($obj));
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:308: characters 13-22
		$_g_head = $ti->fields->h;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:308: lines 308-425
		while ($_g_head !== null) {
			unset($r1, $f);
			$val = $_g_head->item;
			$_g_head = $_g_head->next;
			$f = $val;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:310: characters 4-33
			$e = null;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:312: characters 4-48
			$v = \Reflect::field($obj, $f->name);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:316: characters 4-53
			$meta = \Reflect::field($metas, $f->name);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:320: lines 320-322
			if (($meta !== null) && \Reflect::hasField($meta, "hideInForms")) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:321: characters 5-13
				continue;
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:325: characters 4-78
			$rl = \Lambda::filter($ti->relations, function ($r)  use (&$f) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:325: characters 53-75
				return $r->key === $f->name;
			});
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:326: characters 4-38
			$isNull = ($ti->nulls->data[$f->name] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:329: lines 329-422
			if ($rl->length > 0) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:331: characters 5-24
				$r1 = $rl->first();
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:333: characters 5-30
				$objects = new List_hx();
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:335: characters 5-9
				$meta = \Reflect::field($metas, $r1->prop);
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:336: lines 336-356
				if ($meta !== null) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:338: lines 338-341
					if (Boot::dynamicField($meta, 'formPopulate') !== null) {
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:340: characters 7-14
						$objects = \Reflect::callMethod($obj, \Reflect::field($obj, \Std::string(Boot::dynamicField($meta, 'formPopulate')[0])), new \Array_hx());
					}
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:344: lines 344-346
					if (($meta !== null) && \Reflect::hasField($meta, "hideInForms")) {
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:345: characters 7-15
						continue;
					}
				} else {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:350: characters 6-13
					$objects = $r1->manager->all(false)->map(function ($d)  use (&$r1) {
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:352: characters 16-28
						$objects1 = $d->toString();
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:351: lines 351-354
						return new HxAnon([
							"label" => $objects1,
							"value" => \Reflect::field($d, ($r1->manager->table_keys->arr[0] ?? null)),
						]);
					});
				}
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:358: characters 23-29
				$f1 = $f->name;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:358: characters 31-44
				$e1 = $label($r1->prop);
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:358: characters 5-6
				$e = new IntSelect($f1, $e1, \Lambda::array($objects), $v, !$isNull);
			} else {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:363: characters 13-19
				$_g = $f->type;
				$__hx__switch = ($_g->index);
				if ($__hx__switch === 0 || $__hx__switch === 2) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:365: characters 6-7
					$e = new IntInput($f->name, "id", $v, false);
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:366: characters 14-25
					$e->inputType = InputType::ITHidden();
				} else if ($__hx__switch === 1 || $__hx__switch === 3 || $__hx__switch === 6 || $__hx__switch === 24) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:375: characters 23-29
					$f2 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:375: characters 6-7
					$e = new IntInput($f2, $label($f->name), $v, !$isNull);
				} else if ($__hx__switch === 7) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:378: characters 25-31
					$f3 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:378: characters 6-7
					$e = new FloatInput($f3, $label($f->name), $v, !$isNull);
				} else if ($__hx__switch === 8) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:381: characters 23-29
					$f4 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:381: characters 31-44
					$e2 = $label($f->name);
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:381: characters 6-7
					$e = new Checkbox($f4, $e2, \Std::string($v) === "true");
				} else if ($__hx__switch === 9) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:383: characters 18-19
					$n = $_g->params[0];
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:384: characters 26-32
					$f5 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:384: characters 6-7
					$e = new StringInput($f5, $label($f->name), $v, !$isNull, null, "maxlength=" . ($n??'null'));
				} else if ($__hx__switch === 10) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:403: lines 403-413
					if (Form::$USE_DATEPICKER) {
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:408: characters 7-28
						$d1 = $v;
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:409: characters 26-32
						$f6 = $f->name;
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:409: characters 7-8
						$e = new DatePicker($f6, $label($f->name), $d1);
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:410: characters 15-23
						$e->format = "LL";
					} else {
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:412: characters 29-35
						$f7 = $f->name;
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:412: characters 7-8
						$e = new DateDropdowns($f7, $label($f->name), $v);
					}
				} else if ($__hx__switch === 11 || $__hx__switch === 12) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:391: lines 391-399
					if (Form::$USE_DATEPICKER) {
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:394: characters 7-28
						$d2 = $v;
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:395: characters 26-32
						$f8 = $f->name;
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:395: characters 7-8
						$e = new DatePicker($f8, $label($f->name), $d2);
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:396: characters 15-23
						$e->format = "LLLL";
					} else {
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:398: characters 25-31
						$f9 = $f->name;
						#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:398: characters 7-8
						$e = new DateInput($f9, $label($f->name), $v);
					}
				} else if ($__hx__switch === 20) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:369: characters 26-32
					$f10 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:369: characters 6-7
					$e = new StringInput($f10, $label($f->name), $v);
				} else if ($__hx__switch === 13 || $__hx__switch === 14 || $__hx__switch === 15 || $__hx__switch === 21) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:387: characters 23-29
					$f11 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:387: characters 6-7
					$e = new TextArea($f11, $label($f->name), $v, !$isNull);
				} else if ($__hx__switch === 23) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:371: characters 21-25
					$auto = $_g->params[1];
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:371: characters 17-19
					$fl = $_g->params[0];
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:372: characters 20-26
					$f12 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:372: characters 27-40
					$e3 = $label($f->name);
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:372: characters 42-58
					$e4 = \Lambda::array($fl);
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:372: characters 6-7
					$e = new Flags($f12, $e3, $e4, \Std::parseInt($v));
				} else if ($__hx__switch === 31) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:416: characters 16-20
					$name1 = $_g->params[0];
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:417: characters 39-45
					$f13 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:417: characters 47-60
					$e5 = $label($f->name);
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:417: characters 6-7
					$e = new Enum($f13, $e5, $name1, \Std::parseInt($v), !$isNull);
				} else {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:420: characters 26-32
					$f14 = $f->name;
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:420: characters 34-47
					$e6 = $label($f->name);
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:420: characters 6-7
					$e = new StringInput($f14, $e6, "unknown field type : " . (\Std::string($f->type)??'null') . ", value : " . (\Std::string($v)??'null'));
				}
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:424: characters 4-22
			$form->addElement($e);
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:426: characters 3-14
		return $form;
	}

	/**
	 * @param string $name
	 * @param string $action
	 * @param FormMethod $method
	 * 
	 * @return void
	 */
	public function __construct ($name, $action = null, $method = null) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:51: characters 3-33
		$this->requiredClass = "formRequired";
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:52: characters 3-43
		$this->requiredErrorClass = "formRequiredError";
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:53: characters 3-41
		$this->invalidErrorClass = "formInvalidError";
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:54: characters 3-32
		$this->labelRequiredIndicator = " *";
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:55: characters 3-67
		$this->defaultClass = (Form::$USE_TWITTER_BOOTSTRAP ? "form-horizontal" : "");
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:57: characters 3-23
		$this->forcePopulate = true;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:58: characters 3-20
		$this->multipart = false;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:59: characters 3-29
		$this->autoGenSubmitButton = true;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:61: characters 3-17
		$this->id = $name;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:62: characters 3-19
		$this->name = $name;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:64: lines 64-68
		if ($action === null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:65: characters 4-30
			$this->action = Web::getURI();
		} else {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:67: characters 4-24
			$this->action = $action;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:70: characters 3-60
		$this->method = ($method === null ? FormMethod::POST() : $method);
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:72: characters 3-25
		$this->elements = new \Array_hx();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:73: characters 3-27
		$this->extraErrors = new List_hx();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:74: characters 3-24
		$this->fieldsets = new StringMap();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:75: characters 3-72
		$this->addFieldset("__default", new FieldSet("__default", "Default", false));
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:77: characters 3-35
		$this->addElement(new CSRFProtection());
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:79: characters 3-20
		$this->toString = Boot::getInstanceClosure($this, 'render');
	}

	/**
	 * Adds a form element to the form
	 * @param	element
	 * @param	?fieldSetKey	Add it to a specific fieldset
	 * @param 	?index			which index do u want to push it
	 * @return
	 * 
	 * @param FormElement $element
	 * @param int $index
	 * @param string $fieldSetKey
	 * 
	 * @return FormElement
	 */
	public function addElement ($element, $index = null, $fieldSetKey = "__default") {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:90: lines 90-111
		if ($fieldSetKey === null) {
			$fieldSetKey = "__default";
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:91: characters 3-28
		$element->parentForm = $this;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:92: lines 92-99
		if ($index !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:93: characters 4-39
			$out = $this->elements->slice(0, $index);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:94: characters 4-31
			$out = $out->concat(\Array_hx::wrap([$element]));
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:95: characters 4-43
			$out = $out->concat($this->elements->slice($index));
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:96: characters 4-18
			$this->elements = $out;
		} else {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:98: characters 4-26
			$_this = $this->elements;
			$_this->arr[$_this->length] = $element;
			++$_this->length;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:102: lines 102-105
		if ($fieldSetKey !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:103: characters 4-45
			if (!array_key_exists($fieldSetKey, $this->fieldsets->data)) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:103: characters 40-45
				throw new HxException("No fieldset '" . ($fieldSetKey??'null') . "' exists in '" . ($this->name??'null') . "' form.");
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:104: characters 4-53
			$_this1 = ($this->fieldsets->data[$fieldSetKey] ?? null)->elements;
			$_this1->arr[$_this1->length] = $element;
			++$_this1->length;

		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:110: characters 3-17
		return $element;
	}

	/**
	 * @param string $error
	 * 
	 * @return void
	 */
	public function addError ($error) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:486: characters 3-25
		$this->extraErrors->add($error);
	}

	/**
	 * @param string $fieldSetKey
	 * @param FieldSet $fieldSet
	 * 
	 * @return void
	 */
	public function addFieldset ($fieldSetKey, $fieldSet) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:139: characters 3-23
		$fieldSet->form = $this;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:140: characters 3-39
		$this->fieldsets->data[$fieldSetKey] = $fieldSet;
	}

	/**
	 * @return bool
	 */
	public function checkToken () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:481: characters 3-19
		return $this->isValid();
	}

	/**
	 * @return void
	 */
	public function clearData () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:432: lines 432-434
		$_g = 0;
		$_g1 = $this->getElements();
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:432: characters 8-15
			$element = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:432: lines 432-434
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:433: characters 4-24
			$element->value = null;
		}
	}

	/**
	 * Prints form close tag ...</form>
	 * 
	 * @return string
	 */
	public function getCloseTag () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:457: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:458: characters 3-61
		$s->add("<div style=\"clear:both; height:0px;\">&nbsp;</div>");
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:459: characters 3-89
		$s->add("<input type=\"hidden\" name=\"" . ($this->name??'null') . "_formSubmitted\" value=\"true\" /></form>");
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:460: characters 3-22
		return $s->b;
	}

	/**
	 * return datas contained in current form elements
	 * @return
	 * 
	 * @return StringMap
	 */
	public function getData () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:188: characters 3-40
		$data = new StringMap();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:189: lines 189-193
		$_g = 0;
		$_g1 = $this->getElements();
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:189: characters 8-15
			$element = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:189: lines 189-193
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:191: characters 4-35
			if ($element->name === null) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:191: characters 30-35
				throw new HxException("Element has no name : " . ($element->toString()??'null'));
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:192: characters 4-47
			$key = $element->name;
			$value = $element->getValue();
			$data->data[$key] = $value;

		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:194: characters 3-14
		return $data;
	}

	/**
	 * return datas in an anonymous object
	 * @return
	 * 
	 * @return mixed
	 */
	public function getDatasAsObject () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:203: characters 3-18
		$data = new HxAnon();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:204: lines 204-206
		$_g = 0;
		$_g1 = $this->elements;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:204: characters 9-11
			$el = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:204: lines 204-206
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:205: characters 4-45
			\Reflect::setField($data, $el->name, $el->value);
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:207: characters 3-14
		return $data;
	}

	/**
	 * @param string $name
	 * 
	 * @return FormElement
	 */
	public function getElement ($name) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:154: characters 3-38
		if (($name === null) || ($name === "")) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:154: characters 33-38
			throw new HxException("Element name is null");
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:155: lines 155-157
		$_g = 0;
		$_g1 = $this->elements;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:155: characters 8-15
			$element = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:155: lines 155-157
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:156: characters 4-44
			if ($element->name === $name) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:156: characters 30-44
				return $element;
			}
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:158: characters 3-14
		return null;
	}

	/**
	 * @param string $name
	 * @param Class $type
	 * 
	 * @return mixed
	 */
	public function getElementTyped ($name, $type) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:178: characters 3-36
		$o = $this->getElement($name);
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:179: characters 3-11
		return $o;
	}

	/**
	 * @return \Array_hx
	 */
	public function getElements () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:507: characters 3-18
		return $this->elements;
	}

	/**
	 * @return string
	 */
	public function getErrors () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:527: lines 527-528
		if (!$this->isSubmitted()) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:528: characters 4-13
			return "";
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:530: characters 3-37
		$s = new \StringBuf();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:531: characters 3-32
		$errors = $this->getErrorsList();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:533: lines 533-543
		if ($errors->length > 0) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:535: characters 4-72
			if (Form::$USE_TWITTER_BOOTSTRAP) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:535: characters 31-72
				$s->add("<div class=\"alert alert-danger\">");
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:536: characters 4-39
			$s->add("<ul class=\"formErrors\" >");
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:537: characters 18-24
			$_g_head = $errors->h;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:537: lines 537-540
			while ($_g_head !== null) {
				$val = $_g_head->item;
				$_g_head = $_g_head->next;
				$error = $val;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:539: characters 5-32
				$s->add("<li>" . ($error??'null') . "</li>");
			}

			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:541: characters 4-18
			$s->add("</ul>");
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:542: characters 4-46
			if (Form::$USE_TWITTER_BOOTSTRAP) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:542: characters 31-46
				$s->add("</div>");
			}
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:544: characters 3-22
		return $s->b;
	}

	/**
	 * @return List_hx
	 */
	public function getErrorsList () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:491: characters 3-12
		$this->isValid();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:493: characters 3-40
		$errors = new List_hx();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:495: characters 12-23
		$_g_head = $this->extraErrors->h;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:495: lines 495-496
		while ($_g_head !== null) {
			$val = $_g_head->item;
			$_g_head = $_g_head->next;
			$e = $val;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:496: characters 4-17
			$errors->add($e);
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:498: lines 498-500
		$_g1 = 0;
		$_g2 = $this->getElements();
		while ($_g1 < $_g2->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:498: characters 8-15
			$element = ($_g2->arr[$_g1] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:498: lines 498-500
			++$_g1;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:499: characters 18-37
			$_g1_head = $element->getErrors()->h;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:499: lines 499-500
			while ($_g1_head !== null) {
				$val1 = $_g1_head->item;
				$_g1_head = $_g1_head->next;
				$error = $val1;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:500: characters 5-22
				$errors->add($error);
			}

		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:502: characters 3-16
		return $errors;
	}

	/**
	 * @return StringMap
	 */
	public function getFieldsets () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:145: characters 3-19
		return $this->fieldsets;
	}

	/**
	 * @param string $elementName
	 * 
	 * @return string
	 */
	public function getLabel ($elementName) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:150: characters 3-46
		return $this->getElement($elementName)->getLabel();
	}

	/**
	 * Prints form open tag <form ...>
	 * 
	 * @return string
	 */
	public function getOpenTag () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:443: lines 443-448
		$_g = 0;
		$_g1 = $this->elements;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:443: characters 9-10
			$e = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:443: lines 443-448
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:444: lines 444-447
			if ((\Type::getClass($e) === Boot::getClass(FileUpload::class)) || (\Type::getClass($e) === Boot::getClass(ImageUpload::class))) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:445: characters 5-21
				$this->multipart = true;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:446: characters 5-10
				break;
			}
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:449: characters 3-181
		return "<form id=\"" . ($this->id??'null') . "\" class=\"" . ($this->defaultClass??'null') . "\" name=\"" . ($this->name??'null') . "\" method=\"" . (\Std::string($this->method)??'null') . "\" action=\"" . ($this->action??'null') . "\" " . ((($this->multipart ? "enctype=\"multipart/form-data\"" : ""))??'null') . " >";
	}

	/**
	 * @return string
	 */
	public function getSubmittedValue () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:522: characters 10-57
		return (\App::$current->params->data[($this->name??'null') . "_formSubmitted"] ?? null);
	}

	/**
	 * Get the typed value of a form element.
	 * The value can be of any type !
	 *
	 * @param	elementName
	 * @return
	 * 
	 * @param string $elementName
	 * 
	 * @return mixed
	 */
	public function getValueOf ($elementName) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:174: characters 3-39
		return $this->getElement($elementName)->value;
	}

	/**
	 * @return bool
	 */
	public function isSubmitted () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:517: characters 3-67
		return (\App::$current->params->data[($this->name??'null') . "_formSubmitted"] ?? null) === "true";
	}

	/**
	 * @return bool
	 */
	public function isValid () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:465: characters 3-35
		if (!$this->isSubmitted()) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:465: characters 23-35
			return false;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:467: characters 3-13
		$this->populate();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:469: characters 3-20
		$valid = true;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:471: lines 471-475
		$_g = 0;
		$_g1 = $this->getElements();
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:471: characters 8-15
			$element = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:471: lines 471-475
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:473: characters 4-20
			$element->filter();
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:474: characters 4-41
			if (!$element->isValid()) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:474: characters 28-41
				$valid = false;
			}
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:476: characters 3-44
		if ($this->extraErrors->length > 0) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:476: characters 31-44
			$valid = false;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:477: characters 3-15
		return $valid;
	}

	/**
	 * populate Form from anonymous object or if null from web params.
	 * @param	custom
	 * 
	 * @param mixed $custom
	 * 
	 * @return void
	 */
	public function populate ($custom = null) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:216: lines 216-229
		if ($custom !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:218: lines 218-223
			$_g = 0;
			$_g1 = $this->getElements();
			while ($_g < $_g1->length) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:218: characters 9-16
				$element = ($_g1->arr[$_g] ?? null);
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:218: lines 218-223
				++$_g;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:219: characters 5-26
				$n = $element->name;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:220: characters 5-38
				$v = \Reflect::field($custom, $n);
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:221: lines 221-222
				if ($v !== null) {
					#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:222: characters 6-23
					$element->value = $v;
				}
			}
		} else {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:225: lines 225-228
			$_g2 = 0;
			$_g11 = $this->getElements();
			while ($_g2 < $_g11->length) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:225: characters 9-16
				$element1 = ($_g11->arr[$_g2] ?? null);
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:225: lines 225-228
				++$_g2;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:227: characters 5-23
				$element1->populate();
			}
		}
	}

	/**
	 * @param FormElement $element
	 * 
	 * @return bool
	 */
	public function removeElement ($element) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:115: lines 115-126
		if ($this->elements->remove($element)) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:117: characters 4-28
			$element->parentForm = null;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:118: characters 16-25
			$fs = new NativeIndexedArrayIterator(array_values($this->fieldsets->data));
			while ($fs->hasNext()) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:118: lines 118-121
				$fs1 = $fs->next();
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:120: characters 5-32
				$fs1->elements->remove($element);
			}

			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:125: characters 4-15
			return true;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:127: characters 3-15
		return false;
	}

	/**
	 * @param string $name
	 * 
	 * @return void
	 */
	public function removeElementByName ($name) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:162: characters 3-28
		$e = $this->getElement($name);
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:163: characters 3-34
		if ($e !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:163: characters 18-34
			$this->removeElement($e);
		}
	}

	/**
	 * Render form's HTML
	 * 
	 * @return string
	 */
	public function render () {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:553: characters 3-37
		$s = new \StringBuf();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:554: characters 3-22
		$s->add($this->getOpenTag());
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:557: lines 557-558
		if ($this->isSubmitted()) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:558: characters 4-22
			$s->add($this->getErrors());
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:560: lines 560-562
		$_g = 0;
		$_g1 = $this->getElements();
		while ($_g < $_g1->length) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:560: characters 8-15
			$element = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:560: lines 560-562
			++$_g;
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:561: lines 561-562
			if (($element !== $this->submitButton) && ($element->internal === false)) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:562: characters 5-42
				$s->add("\x09" . ($element->getFullRow()??'null') . "\x0A");
			}
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:565: lines 565-570
		if ($this->submitButton !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:566: characters 4-34
			$this->submitButton->parentForm = $this;
		} else if ($this->autoGenSubmitButton) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:568: characters 4-93
			$this->submitButton = new Submit("submit", ($this->submitButtonLabel !== null ? $this->submitButtonLabel : "OK"));
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:569: characters 4-34
			$this->submitButton->parentForm = $this;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:571: characters 3-58
		if ($this->submitButton !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:571: characters 26-58
			$s->add($this->submitButton->getFullRow());
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:573: characters 3-23
		$s->add($this->getCloseTag());
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:575: characters 3-22
		return $s->b;
	}

	/**
	 * @param FormElement $el
	 * 
	 * @return FormElement
	 */
	public function setSubmitButton ($el) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:132: characters 3-20
		$this->submitButton = $el;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:133: characters 3-33
		$this->submitButton->parentForm = $this;
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:134: characters 3-12
		return $el;
	}

	/**
	 * update a spod object from the content of the form
	 * @param	data
	 * @param	obj
	 * 
	 * @param Object_hx $obj
	 * 
	 * @return void
	 */
	public function toSpod ($obj) {
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:238: characters 3-24
		if (!$this->isValid()) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:238: characters 19-24
			throw new HxException("submitted form should be valid");
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:239: characters 3-24
		$data = $this->getData();
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:242: characters 3-41
		$id = \Std::parseInt(($data->data["id"] ?? null));
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:243: characters 3-25
		if ($id === 0) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:243: characters 16-25
			$id = null;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:244: lines 244-246
		if ($id !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:245: characters 4-14
			$obj->lock();
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:248: characters 13-24
		$f = new NativeIndexedArrayIterator(array_map("strval", array_keys($data->data)));
		while ($f->hasNext()) {
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:248: lines 248-267
			$f1 = $f->next();
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:251: characters 4-41
			if ($this->getElement($f1) === null) {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:251: characters 36-41
				throw new HxException("field '" . ($f1??'null') . "' was not in the original form");
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:252: characters 4-24
			$v = ($data->data[$f1] ?? null);
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:253: characters 4-27
			if ($f1 === "id") {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:253: characters 19-27
				continue;
			}
			#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:262: lines 262-266
			try {
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:263: characters 5-35
				\Reflect::setProperty($obj, $f1, $v);
			} catch (\Throwable $__hx__caught_e) {
				CallStack::saveExceptionTrace($__hx__caught_e);
				$__hx__real_e = ($__hx__caught_e instanceof HxException ? $__hx__caught_e->e : $__hx__caught_e);
				$e = $__hx__real_e;
				#/home/bubar/projects/sugoi/src/sugoi/form/Form.hx:265: characters 5-10
				throw new HxException("Error '" . (\Std::string($e)??'null') . "' while setting value " . (\Std::string($v)??'null') . " to " . ($f1??'null'));
			}
		}

	}

	public function __toString() {
		return $this->toString();
	}
}

Boot::registerClass(Form::class, 'sugoi.form.Form');
