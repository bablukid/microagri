<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sugoi\form\elements;

use \php\_Boot\HxAnon;
use \php\Boot;
use \haxe\CallStack;
use \sugoi\form\FormElement;
use \php\_Boot\HxException;
use \sugoi\form\ListData;
use \sugoi\form\Form;

/**
 * A list of selectBox for day + month + year
 */
class DateDropdowns extends FormElement {
	/**
	 * @var Selectbox
	 */
	public $daySelector;
	/**
	 * @var int
	 */
	public $maxOffset;
	/**
	 * @var int
	 */
	public $minOffset;
	/**
	 * @var Selectbox
	 */
	public $monthSelector;
	/**
	 * @var int
	 */
	public $yearMax;
	/**
	 * @var int
	 */
	public $yearMin;
	/**
	 * @var Selectbox
	 */
	public $yearSelector;

	/**
	 * @param string $name
	 * @param string $label
	 * @param \Date $_value
	 * @param bool $required
	 * @param int $yearMin
	 * @param int $yearMax
	 * @param \Array_hx $validators
	 * @param string $attibutes
	 * 
	 * @return void
	 */
	public function __construct ($name, $label, $_value = null, $required = false, $yearMin = 1950, $yearMax = null, $validators = null, $attibutes = "") {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:26: lines 26-67
		if ($required === null) {
			$required = false;
		}
		if ($yearMin === null) {
			$yearMin = 1950;
		}
		if ($attibutes === null) {
			$attibutes = "";
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:27: characters 3-10
		parent::__construct();
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:28: characters 3-19
		$this->name = $name;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:29: characters 3-21
		$this->label = $label;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:31: lines 31-35
		if ($_value === null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:32: characters 4-22
			$this->value = \Date::now();
		} else {
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:34: characters 4-18
			$this->value = $_value;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:37: characters 3-27
		$this->required = $required;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:38: characters 3-30
		$this->attributes = $attibutes;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:39: characters 3-25
		$this->yearMin = $yearMin;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:40: characters 3-25
		$this->yearMax = $yearMax;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:42: characters 3-19
		$this->maxOffset = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:43: characters 3-19
		$this->minOffset = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:45: characters 3-23
		$day = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:46: characters 3-25
		$month = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:47: characters 3-24
		$year = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:49: lines 49-54
		if ($this->value !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:51: characters 4-26
			$day = $this->value->getDate();
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:52: characters 4-32
			$month = $this->value->getMonth() + 1;
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:53: characters 4-31
			$year = $this->value->getFullYear();
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:56: characters 3-38
		$t = Form::$translator;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:57: characters 45-55
		$tmp = $t->_("day");
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:57: characters 3-84
		$this->daySelector = new IntSelect(($name??'null') . "_day", $tmp, ListData::getDays(), $day, true);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:58: characters 33-46
		$tmp1 = ($name??'null') . "_month";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:58: characters 48-60
		$tmp2 = $t->_("month");
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:58: characters 61-81
		$input = ListData::$months;
		$out = new \Array_hx();
		$c = 1;
		$_g = 0;
		while ($_g < $input->length) {
			$i = ($input->arr[$_g] ?? null);
			++$_g;
			$out->arr[$out->length] = new HxAnon([
				"label" => $i,
				"value" => $c,
			]);
			++$out->length;

			++$c;
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:58: characters 3-93
		$this->monthSelector = new IntSelect($tmp1, $tmp2, $out, $month, true);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:59: characters 47-58
		$tmp3 = $t->_("year");
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:59: characters 3-152
		$this->yearSelector = new IntSelect(($name??'null') . "_year", $tmp3, ListData::getYears(\Date::now()->getFullYear() - 3, \Date::now()->getFullYear() + 3, true), $year, true);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:61: characters 3-79
		$this->daySelector->internal = $this->monthSelector->internal = $this->yearSelector->internal = true;
	}

	/**
	 * @return void
	 */
	public function init () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:78: characters 3-15
		parent::init();
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:80: characters 3-37
		$this->parentForm->addElement($this->daySelector);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:81: characters 3-39
		$this->parentForm->addElement($this->monthSelector);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:82: characters 3-38
		$this->parentForm->addElement($this->yearSelector);
	}

	/**
	 * @return bool
	 */
	public function isValid () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:115: characters 3-14
		return true;
	}

	/**
	 * @return void
	 */
	public function populate () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:88: characters 3-92
		$day = \Std::parseInt((\App::$current->params->data[($this->parentForm->name??'null') . "_" . ($this->daySelector->name??'null')] ?? null));
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:89: characters 3-96
		$month = \Std::parseInt((\App::$current->params->data[($this->parentForm->name??'null') . "_" . ($this->monthSelector->name??'null')] ?? null));
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:90: characters 3-94
		$year = \Std::parseInt((\App::$current->params->data[($this->parentForm->name??'null') . "_" . ($this->yearSelector->name??'null')] ?? null));
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:92: characters 3-107
		$this->value = (($day !== null) && ($month !== null) && ($year !== null) ? new \Date($year, $month - 1, $day, 0, 0, 0) : null);
	}

	/**
	 * @return string
	 */
	public function render () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:122: characters 3-17
		parent::render();
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:124: lines 124-132
		if ($this->value !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:126: lines 126-131
			try {
				#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:127: characters 4-28
				$v = $this->value;
				#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:128: characters 4-35
				$this->daySelector->value = $v->getDate();
				#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:129: characters 26-38
				$tmp = $v->getMonth();
				#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:129: characters 4-40
				$this->monthSelector->value = $tmp + 1;
				#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:130: characters 4-40
				$this->yearSelector->value = $v->getFullYear();
			} catch (\Throwable $__hx__caught_e) {
				CallStack::saveExceptionTrace($__hx__caught_e);
				$__hx__real_e = ($__hx__caught_e instanceof HxException ? $__hx__caught_e->e : $__hx__caught_e);
				$e = $__hx__real_e;
							}
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:134: lines 134-138
		return "<div class=\"row\">\x0A\x09\x09  <div class=\"col-xs-2\">" . ($this->daySelector->render()??'null') . "</div>\x0A\x09\x09  <div class=\"col-xs-6\">" . ($this->monthSelector->render()??'null') . "</div>\x0A\x09\x09  <div class=\"col-xs-4\">" . ($this->yearSelector->render()??'null') . "</div>\x0A\x09\x09</div>";
	}

	/**
	 * @return void
	 */
	public function shortLabels () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:70: characters 3-34
		$this->daySelector->nullMessage = "-D-";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:71: characters 3-36
		$this->monthSelector->nullMessage = "-M-";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:72: characters 3-35
		$this->yearSelector->nullMessage = "-Y-";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:73: characters 24-48
		$input = ListData::$months_short;
		$out = new \Array_hx();
		$c = 1;
		$_g = 0;
		while ($_g < $input->length) {
			$i = ($input->arr[$_g] ?? null);
			++$_g;
			$out->arr[$out->length] = new HxAnon([
				"label" => $i,
				"value" => $c,
			]);
			++$out->length;

			++$c;
		}

		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DateDropdowns.hx:73: characters 3-48
		$this->monthSelector->data = $out;
	}
}

Boot::registerClass(DateDropdowns::class, 'sugoi.form.elements.DateDropdowns');
