<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sugoi\form\elements;

use \php\Boot;
use \sugoi\form\FormElement;

/**
 * DatePicker for Bootstrap 3
 *
 * You'll need to install some additionnal js librairies (moment.js, jquery)
 * more info at : http://eonasdan.github.io/bootstrap-datetimepicker/
 */
class DatePicker extends FormElement {
	/**
	 * @var Selectbox
	 */
	public $daySelector;
	/**
	 * @var string
	 */
	public $format;
	/**
	 * @var int
	 */
	public $maxOffset;
	/**
	 * @var int
	 */
	public $minOffset;
	/**
	 * @var Selectbox
	 */
	public $monthSelector;
	/**
	 * @var int
	 */
	public $yearMax;
	/**
	 * @var int
	 */
	public $yearMin;
	/**
	 * @var Selectbox
	 */
	public $yearSelector;

	/**
	 * @param string $name
	 * @param string $label
	 * @param \Date $v
	 * @param bool $required
	 * @param int $yearMin
	 * @param int $yearMax
	 * @param \Array_hx $validators
	 * @param string $attibutes
	 * 
	 * @return void
	 */
	public function __construct ($name, $label, $v = null, $required = false, $yearMin = 1950, $yearMax = null, $validators = null, $attibutes = "") {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:29: lines 29-63
		if ($required === null) {
			$required = false;
		}
		if ($yearMin === null) {
			$yearMin = 1950;
		}
		if ($attibutes === null) {
			$attibutes = "";
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:31: characters 3-10
		parent::__construct();
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:32: characters 3-19
		$this->name = $name;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:33: characters 3-21
		$this->label = $label;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:34: characters 3-18
		$this->format = "LLLL";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:36: lines 36-40
		if ($v === null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:37: characters 4-27
			$this->value = \Date::now();
		} else {
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:39: characters 4-18
			$this->value = $v;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:44: characters 3-27
		$this->required = $required;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:45: characters 3-30
		$this->attributes = $attibutes;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:46: characters 3-25
		$this->yearMin = $yearMin;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:47: characters 3-25
		$this->yearMax = $yearMax;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:49: characters 3-19
		$this->maxOffset = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:50: characters 3-19
		$this->minOffset = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:52: characters 3-16
		$day = "";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:53: characters 3-18
		$month = "";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:54: characters 3-17
		$year = "";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:56: lines 56-61
		if ($this->value !== null) {
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:58: characters 4-29
			$day = "" . ($this->value->getDate()??'null');
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:59: characters 4-35
			$month = "" . (($this->value->getMonth() + 1)??'null');
			#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:60: characters 4-34
			$year = "" . ($this->value->getFullYear()??'null');
		}
	}

	/**
	 * @return bool
	 */
	public function isValid () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:76: characters 3-14
		return true;
	}

	/**
	 * @return void
	 */
	public function populate () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:68: characters 3-64
		$d = (\App::$current->params->data[($this->parentForm->name??'null') . "_" . ($this->name??'null')] ?? null);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:71: characters 3-29
		$this->value = \Date::fromString($d);
	}

	/**
	 * @return string
	 */
	public function render () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:84: characters 3-28
		$d = $this->value->toString();
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:85: characters 3-66
		$defaultDate = "moment(\"" . ($d??'null') . "\", \"YYYY-MM-DD HH:mm:ss\")";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/DatePicker.hx:87: lines 87-114
		return "\x0A\x09\x09\x09\x09<div class='input-group date' id='datetimepicker-" . ($this->name??'null') . "'>       \x0A\x09\x09\x09\x09\x09<span class='input-group-addon'>\x0A\x09\x09\x09\x09\x09\x09<span class='glyphicon glyphicon-calendar'></span>\x0A\x09\x09\x09\x09\x09</span>\x0A\x09\x09\x09\x09\x09<input type='text' class='form-control' />\x0A\x09\x09\x09\x09</div>\x0A\x09\x09\x09\x0A\x09\x09\x09<input type='hidden' name='" . ($this->parentForm->name??'null') . "_" . ($this->name??'null') . "' id='datetimepickerdata-" . ($this->name??'null') . "' value='" . ($d??'null') . "'/>\x0A\x09\x09\x09<script type='text/javascript'>\x0A\x09\x09\x09\x09\$(function () {\x0A\x09\x09\x09\x09\x09\$('#datetimepicker-" . ($this->name??'null') . "').datetimepicker(\x0A\x09\x09\x09\x09\x09\x09{\x0A\x09\x09\x09\x09\x09\x09\x09locale:'fr',\x0A\x09\x09\x09\x09\x09\x09\x09format:'" . ($this->format??'null') . "',\x0A\x09\x09\x09\x09\x09\x09\x09defaultDate:" . ($defaultDate??'null') . "\x0A\x09\x09\x09\x09\x09\x09}\x0A\x09\x09\x09\x09\x09);\x0A\x09\x09\x09\x09\x09//stores the date in mysql format in a hidden input element\x09\x0A\x09\x09\x09\x09\x09\$('#datetimepicker-" . ($this->name??'null') . "').on('dp.change',function(e){\x0A\x09\x09\x09\x09\x09\x09var d = \$('#datetimepicker-" . ($this->name??'null') . "').data('DateTimePicker').date();//moment.js obj\x0A\x09\x09\x09\x09\x09\x09//fix 2038 date overflow bug https://en.wikipedia.org/wiki/Year_2038_problem\x0A\x09\x09\x09\x09\x09\x09if(d.year()>2037) d.year(2037);\x0A\x09\x09\x09\x09\x09\x09console.log(d.toString());\x0A\x09\x09\x09\x09\x09\x09\$('#datetimepickerdata-" . ($this->name??'null') . "').val( d.format('YYYY-MM-DD HH:mm:ss'));\x0A\x09\x09\x09\x09\x09});\x0A\x09\x09\x09\x09});\x0A\x09\x09\x09</script>";
	}
}

Boot::registerClass(DatePicker::class, 'sugoi.form.elements.DatePicker');
