<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sugoi\form\elements;

use \php\Boot;
use \sugoi\tools\Utils;
use \sugoi\form\FormElement;
use \haxe\io\StringInput as IoStringInput;
use \haxe\io\Bytes;

/**
 * Manage an <input type="file" /> element.
 */
class FileUpload extends FormElement {
	/**
	 * @var string
	 */
	public $fileName;
	/**
	 * @var int
	 */
	public $maxSize;

	/**
	 * @param string $name
	 * @param string $label
	 * @param Bytes $value
	 * @param bool $required
	 * @param string $toFolder
	 * @param bool $keepFullFileName
	 * 
	 * @return void
	 */
	public function __construct ($name, $label, $value = null, $required = false, $toFolder = null, $keepFullFileName = true) {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:16: lines 16-24
		if ($required === null) {
			$required = false;
		}
		if ($keepFullFileName === null) {
			$keepFullFileName = true;
		}
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:17: characters 3-10
		parent::__construct();
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:18: characters 3-19
		$this->name = $name;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:19: characters 3-21
		$this->label = $label;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:20: characters 3-21
		$this->value = $value;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:21: characters 3-27
		$this->required = $required;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:22: characters 3-18
		$this->fileName = null;
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:23: characters 3-14
		$this->maxSize = 6;
	}

	/**
	 * @param string $s
	 * 
	 * @return Bytes
	 */
	public function getTypedValue ($s) {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:28: characters 3-71
		$request = Utils::getMultipart(1048576 * $this->maxSize);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:32: characters 3-59
		$strData = ($request->data[($this->parentForm->name??'null') . "_" . ($this->name??'null')] ?? null);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:33: characters 3-67
		$this->fileName = ($request->data[($this->parentForm->name??'null') . "_" . ($this->name??'null') . "_filename"] ?? null);
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:35: characters 3-52
		return (new IoStringInput($strData))->readAll();
	}

	/**
	 * @return string
	 */
	public function render () {
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:42: characters 3-39
		$n = ($this->parentForm->name??'null') . "_" . ($this->name??'null');
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:46: characters 3-23
		$str = "";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:49: characters 3-84
		$str = ($str??'null') . "<input type=\"file\" name=\"" . ($n??'null') . "\" id=\"" . ($n??'null') . "\" " . ($this->attributes??'null') . " />";
		#/home/bubar/projects/sugoi/src/sugoi/form/elements/FileUpload.hx:54: characters 3-13
		return $str;
	}
}

Boot::registerClass(FileUpload::class, 'sugoi.form.elements.FileUpload');
