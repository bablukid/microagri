<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sys\db;

use \php\_Boot\HxDynamicStr;
use \haxe\io\_BytesData\Container;
use \php\_Boot\HxAnon;
use \php\Boot;
use \haxe\rtti\Meta;
use \php\_Boot\HxString;
use \haxe\ds\List_hx;
use \haxe\ds\StringMap;
use \haxe\Unserializer;
use \php\_Boot\HxException;
use \haxe\io\Bytes;
use \haxe\Serializer;

/**
 * Record Manager : the persistent object database manager. See the tutorial on
 * Haxe website to learn how to use Record.
 */
class Manager {
	/**
	 * @var string
	 */
	const cache_field = "__cache__";

	/**
	 * @var StringMap
	 */
	static public $KEYWORDS;
	/**
	 * @var Connection
	 */
	static public $cnx;
	/**
	 * @var List_hx
	 */
	static public $init_list;
	/**
	 * @var string
	 */
	static public $lockMode;
	/**
	 * @var StringMap
	 */
	static public $object_cache;

	/**
	 * @var object
	 */
	public $class_proto;
	/**
	 * @var object
	 */
	public $table_infos;
	/**
	 * @var \Array_hx
	 */
	public $table_keys;
	/**
	 * @var string
	 */
	public $table_name;

	/**
	 * @return string
	 */
	static public function __depends () {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:720: characters 39-79
		return Bytes::alloc(0)->toString();
	}

	/**
	 * @return void
	 */
	static public function cleanup () {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:602: characters 3-41
		Manager::$object_cache = new StringMap();
	}

	/**
	 * @param object $field
	 * 
	 * @return string
	 */
	static public function getFieldName ($field) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:130: characters 18-25
		$__hx__switch = ($field->t->index);
		if ($__hx__switch === 30 || $__hx__switch === 31) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:132: characters 5-25
			return "data_" . ($field->name??'null');
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:134: characters 5-15
			return $field->name;
		}
	}

	/**
	 * @return void
	 */
	static public function initialize () {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:594: characters 3-21
		$l = Manager::$init_list;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:595: characters 3-12
		Manager::$init_list = new List_hx();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:596: characters 13-14
		$_g_head = $l->h;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:596: lines 596-598
		while ($_g_head !== null) {
			$val = $_g_head->item;
			$_g_head = $_g_head->next;
			$m = $val;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:597: lines 597-598
			$_g = 0;
			$_g1 = $m->table_infos->relations;
			while ($_g < $_g1->length) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:597: characters 9-10
				$r = ($_g1->arr[$_g] ?? null);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:597: lines 597-598
				++$_g;
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:598: characters 5-22
				$m->initRelation($r);
			}

		}

	}

	/**
	 * @param string $a
	 * @param string $b
	 * @param bool $eq
	 * 
	 * @return string
	 */
	static public function nullCompare ($a, $b, $eq) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:528: lines 528-532
		if (($a === null) || ($a === "NULL")) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:529: characters 11-47
			if ($eq) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:529: characters 17-27
				return "" . ($b??'null') . " IS NULL";
			} else {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:529: characters 32-46
				return "" . ($b??'null') . " IS NOT NULL";
			}
		} else if (($b === null) || ($b === "NULL")) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:531: characters 11-47
			if ($eq) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:531: characters 17-27
				return "" . ($a??'null') . " IS NULL";
			} else {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:531: characters 32-46
				return "" . ($a??'null') . " IS NOT NULL";
			}
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:534: lines 534-535
		if (Manager::$cnx->dbName() !== "MySQL") {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:535: characters 4-40
			return ($a??'null') . ((($eq ? " = " : " != "))??'null') . ($b??'null');
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:536: characters 3-25
		$sql = ($a??'null') . " <=> " . ($b??'null');
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:537: characters 3-33
		if (!$eq) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:537: characters 13-33
			$sql = "NOT(" . ($sql??'null') . ")";
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:538: characters 3-13
		return $sql;
	}

	/**
	 * @param mixed $v
	 * 
	 * @return string
	 */
	static public function quoteAny ($v) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:697: lines 697-699
		if ($v === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:698: characters 4-17
			return "NULL";
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:701: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:702: characters 3-21
		Manager::$cnx->addValue($s, $v);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:703: characters 3-22
		return $s->b;
	}

	/**
	 * @param string $v
	 * @param object $it
	 * 
	 * @return string
	 */
	static public function quoteList ($v, $it) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:707: characters 3-27
		$b = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:708: characters 3-20
		$first = true;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:709: lines 709-713
		if ($it !== null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:710: characters 14-16
			$v1 = $it->iterator();
			while ($v1->hasNext()) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:710: lines 710-713
				$v2 = $v1->next();
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:711: characters 5-55
				if ($first) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:711: characters 17-30
					$first = false;
				} else {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:711: characters 36-37
					$b1 = $b;
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:711: characters 36-55
					$b1->b = ($b1->b??'null') . (mb_chr(44)??'null');
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:712: characters 5-23
				Manager::$cnx->addValue($b, $v2);
			}
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:714: lines 714-715
		if ($first) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:715: characters 4-18
			return "FALSE";
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:716: characters 3-42
		return ($v??'null') . " IN (" . ($b->b??'null') . ")";
	}

	/**
	 * @param Connection $c
	 * 
	 * @return Connection
	 */
	static public function set_cnx ($c) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:51: characters 3-10
		Manager::$cnx = $c;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:52: characters 3-71
		Manager::$lockMode = (($c !== null) && ($c->dbName() === "MySQL") ? " FOR UPDATE" : "");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:53: characters 3-11
		return $c;
	}

	/**
	 * @param Class $classval
	 * 
	 * @return void
	 */
	public function __construct ($classval) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:64: characters 3-66
		$m = Boot::dynamicField(Meta::getType($classval), 'rtti');
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:65: characters 3-24
		if ($m === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:65: characters 19-24
			throw new HxException("Missing @rtti for class " . (\Type::getClassName($classval)??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:66: characters 3-44
		$this->table_infos = Unserializer::run(($m->arr[0] ?? null));
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:67: characters 3-44
		$this->table_name = $this->quoteField($this->table_infos->name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:68: characters 3-31
		$this->table_keys = $this->table_infos->key;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:70: characters 3-30
		$this->class_proto = $classval;
	}

	/**
	 * @param mixed $x
	 * @param string $prop
	 * @param string $key
	 * @param bool $lock
	 * 
	 * @return mixed
	 */
	public function __hx__renamed__get ($x, $prop, $key, $lock) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:618: characters 3-33
		$v = \Reflect::field($x, $prop);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:619: lines 619-620
		if ($v !== null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:620: characters 4-12
			return $v;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:621: characters 3-50
		$y = $this->unsafeGet(\Reflect::field($x, $key), $lock);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:622: characters 3-29
		\Reflect::setField($x, $prop, $v);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:623: characters 3-11
		return $y;
	}

	/**
	 * @param mixed $x
	 * @param string $prop
	 * @param string $key
	 * @param mixed $v
	 * 
	 * @return mixed
	 */
	public function __hx__renamed__set ($x, $prop, $key, $v) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:627: characters 3-29
		\Reflect::setField($x, $prop, $v);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:628: lines 628-631
		if ($v === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:629: characters 4-32
			\Reflect::setField($x, $key, null);
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:631: characters 4-58
			\Reflect::setField($x, $key, \Reflect::field($v, ($this->table_keys->arr[0] ?? null)));
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:632: characters 3-11
		return $v;
	}

	/**
	 * @param \StringBuf $s
	 * @param object $x
	 * 
	 * @return void
	 */
	public function addCondition ($s, $x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:542: characters 3-20
		$first = true;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:543: lines 543-557
		if ($x !== null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:544: lines 544-557
			$_g = 0;
			$_g1 = \Reflect::fields($x);
			while ($_g < $_g1->length) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:544: characters 9-10
				$f = ($_g1->arr[$_g] ?? null);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:544: lines 544-557
				++$_g;
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:545: lines 545-548
				if ($first) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:546: characters 6-19
					$first = false;
				} else {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:548: characters 6-20
					$s->add(" AND ");
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:549: characters 5-25
				$s->add($this->quoteField($f));
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:550: characters 5-32
				$d = \Reflect::field($x, $f);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:551: lines 551-556
				if ($d === null) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:552: characters 6-23
					$s->add(" IS NULL");
				} else {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:554: characters 6-18
					$s->add(" = ");
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:555: characters 6-28
					$this->getCnx()->addValue($s, $d);
				}
			}
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:558: lines 558-559
		if ($first) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:559: characters 4-17
			$s->add("TRUE");
		}
	}

	/**
	 * @param \StringBuf $s
	 * @param object $x
	 * 
	 * @return void
	 */
	public function addKeys ($s, $x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:425: characters 3-20
		$first = true;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:426: lines 426-437
		$_g = 0;
		$_g1 = $this->table_keys;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:426: characters 8-9
			$k = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:426: lines 426-437
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:427: lines 427-430
			if ($first) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:428: characters 5-18
				$first = false;
			} else {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:430: characters 5-19
				$s->add(" AND ");
			}
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:431: characters 4-24
			$s->add($this->quoteField($k));
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:432: characters 4-16
			$s->add(" = ");
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:433: characters 4-31
			$f = \Reflect::field($x, $k);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:434: lines 434-435
			if ($f === null) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:435: characters 5-10
				throw new HxException("Missing key " . ($k??'null'));
			}
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:436: characters 4-26
			$this->getCnx()->addValue($s, $f);
		}

	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function addToCache ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:657: characters 3-38
		$_this = Manager::$object_cache;
		$key = $this->makeCacheKey($x);
		$_this->data[$key] = $x;
	}

	/**
	 * @param bool $lock
	 * 
	 * @return List_hx
	 */
	public function all ($lock = null) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:78: characters 3-59
		return $this->unsafeObjects("SELECT * FROM " . ($this->table_name??'null'), $lock);
	}

	/**
	 * @param mixed $x
	 * @param bool $lock
	 * 
	 * @return mixed
	 */
	public function cacheObject ($x, $lock) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:395: characters 3-58
		$o = \Type::createEmptyInstance($this->class_proto);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:396: characters 11-28
		$o->_manager = $this;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:398: characters 3-20
		$this->normalizeCache($x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:399: lines 399-407
		$_g = 0;
		$_g1 = \Reflect::fields($x);
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:399: characters 8-9
			$f = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:399: lines 399-407
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:401: characters 4-76
			$val = \Reflect::field($x, $f);
			$info = ($this->table_infos->hfields->data[$f] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:402: lines 402-406
			if ($info !== null) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:404: characters 5-40
				$fieldName = Manager::getFieldName($info);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:405: characters 5-40
				\Reflect::setField($o, $fieldName, $val);
			}
		}

		#/home/bubar/projects/spod/src/sys/db/Manager.hx:408: characters 3-36
		\Reflect::setField($o, "__cache__", $x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:409: characters 3-16
		$this->addToCache($o);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:410: characters 11-25
		$o->_lock = $lock;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:411: characters 3-11
		return $o;
	}

	/**
	 * @return Class
	 */
	public function dbClass () {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:565: characters 3-26
		return $this->class_proto;
	}

	/**
	 * @return object
	 */
	public function dbInfos () {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:569: characters 3-21
		return $this->table_infos;
	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function doDelete ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:273: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:274: characters 3-24
		$s->add("DELETE FROM ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:275: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:276: characters 3-19
		$s->add(" WHERE ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:277: characters 3-15
		$this->addKeys($s, $x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:278: characters 3-30
		$this->unsafeExecute($s->b);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:279: characters 3-21
		$this->removeFromCache($x);
	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function doInsert ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:139: characters 3-12
		$this->unmake($x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:140: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:141: characters 3-27
		$fields = new List_hx();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:142: characters 3-27
		$values = new List_hx();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:143: characters 3-44
		$cache = \Reflect::field($x, "__cache__");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:144: lines 144-147
		if ($cache === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:146: characters 35-40
			$cache = new HxAnon();
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:146: characters 4-46
			\Reflect::setField($x, "__cache__", $cache);
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:149: lines 149-179
		$_g = 0;
		$_g1 = $this->table_infos->fields;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:149: characters 8-9
			$f = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:149: lines 149-179
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:150: lines 150-151
			$name = $f->name;
			$fieldName = Manager::getFieldName($f);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:152: characters 4-47
			$v = \Reflect::field($x, $fieldName);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:153: lines 153-176
			if ($v !== null) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:154: characters 5-33
				$fields->add($this->quoteField($name));
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:155: characters 13-16
				if ($f->t->index === 30) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:156: characters 17-18
					$v = $this->doUpdateCache($x, $name, $v);
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:159: characters 5-18
				$values->add($v);
			} else if (!$f->isNull) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:162: characters 13-16
				$__hx__switch = ($f->t->index);
				if ($__hx__switch === 1 || $__hx__switch === 3 || $__hx__switch === 5 || $__hx__switch === 6 || $__hx__switch === 7 || $__hx__switch === 23 || $__hx__switch === 24 || $__hx__switch === 25 || $__hx__switch === 26 || $__hx__switch === 27 || $__hx__switch === 28 || $__hx__switch === 29 || $__hx__switch === 31) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:164: characters 6-39
					\Reflect::setField($x, $fieldName, 0);
				} else if ($__hx__switch === 8) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:166: characters 6-43
					\Reflect::setField($x, $fieldName, false);
				} else if ($__hx__switch === 10 || $__hx__switch === 11 || $__hx__switch === 12) {
				} else if ($__hx__switch === 9 || $__hx__switch === 13 || $__hx__switch === 14 || $__hx__switch === 15 || $__hx__switch === 21) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:168: characters 6-40
					\Reflect::setField($x, $fieldName, "");
				} else if ($__hx__switch === 16 || $__hx__switch === 17 || $__hx__switch === 18 || $__hx__switch === 19 || $__hx__switch === 22) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:170: characters 6-60
					\Reflect::setField($x, $fieldName, Bytes::alloc(0));
				} else if ($__hx__switch === 0 || $__hx__switch === 2 || $__hx__switch === 4 || $__hx__switch === 20 || $__hx__switch === 30 || $__hx__switch === 32 || $__hx__switch === 33) {
				}
			}
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:178: characters 4-36
			\Reflect::setField($cache, $name, $v);
		}

		#/home/bubar/projects/spod/src/sys/db/Manager.hx:180: characters 3-24
		$s->add("INSERT INTO ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:181: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:182: lines 182-198
		if (($fields->length > 0) || (Manager::$cnx->dbName() !== "SQLite")) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:184: characters 4-15
			$s->add(" (");
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:185: characters 4-27
			$s->add($fields->join(","));
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:186: characters 4-23
			$s->add(") VALUES (");
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:187: characters 4-21
			$first = true;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:188: characters 14-20
			$_g2_head = $values->h;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:188: lines 188-194
			while ($_g2_head !== null) {
				$val = $_g2_head->item;
				$_g2_head = $_g2_head->next;
				$v1 = $val;
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:189: lines 189-192
				if ($first) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:190: characters 6-11
					$first = false;
				} else {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:192: characters 6-17
					$s->add(", ");
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:193: characters 5-27
				$this->getCnx()->addValue($s, $v1);
			}

			#/home/bubar/projects/spod/src/sys/db/Manager.hx:195: characters 4-14
			$s->add(")");
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:197: characters 4-28
			$s->add(" DEFAULT VALUES");
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:199: characters 3-30
		$this->unsafeExecute($s->b);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:200: characters 11-18
		$x->_lock = true;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:202: lines 202-203
		if (($this->table_keys->length === 1) && (\Reflect::field($x, ($this->table_keys->arr[0] ?? null)) === null)) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:203: characters 4-61
			\Reflect::setField($x, ($this->table_keys->arr[0] ?? null), $this->getCnx()->lastInsertId());
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:204: characters 3-16
		$this->addToCache($x);
	}

	/**
	 * @param mixed $i
	 * 
	 * @return void
	 */
	public function doLock ($i) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:283: lines 283-284
		if ($i->_lock) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:284: characters 4-10
			return;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:285: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:286: characters 3-26
		$s->add("SELECT * FROM ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:287: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:288: characters 3-19
		$s->add(" WHERE ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:289: characters 3-16
		$this->addKeys($s, $i);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:291: lines 291-292
		if (!Boot::equal($this->unsafeObject($s->b, true), $i)) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:292: characters 4-9
			throw new HxException("Could not lock object (was deleted ?); try restarting transaction");
		}
	}

	/**
	 * @param string $field
	 * @param mixed $v
	 * 
	 * @return Bytes
	 */
	public function doSerialize ($field, $v) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:319: characters 3-33
		$s = new Serializer();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:320: characters 3-24
		$s->useEnumIndex = true;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:321: characters 3-17
		$s->serialize($v);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:322: characters 3-26
		$str = $s->toString();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:326: characters 10-37
		$tmp = strlen($str);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:326: characters 3-37
		return new Bytes($tmp, new Container($str));
	}

	/**
	 * @param string $field
	 * @param Bytes $b
	 * 
	 * @return mixed
	 */
	public function doUnserialize ($field, $b) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:331: lines 331-332
		if ($b === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:332: characters 4-15
			return null;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:333: characters 3-11
		$str = $b->toString();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:339: lines 339-340
		if ($str === "") {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:340: characters 4-15
			return null;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:341: characters 3-36
		return Unserializer::run($str);
	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function doUpdate ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:220: lines 220-221
		if (!$x->_lock) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:221: characters 4-9
			throw new HxException("Cannot update a not locked object");
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:222: characters 3-35
		$upd = $this->getUpdateStatement($x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:223: characters 3-26
		if ($upd === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:223: characters 20-26
			return;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:224: characters 3-21
		$this->unsafeExecute($upd);
	}

	/**
	 * @param mixed $x
	 * @param string $name
	 * @param mixed $v
	 * 
	 * @return Bytes
	 */
	public function doUpdateCache ($x, $name, $v) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:117: characters 3-67
		$cache = \Reflect::field($x, "cache_" . ($name??'null'));
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:120: lines 120-121
		if ($cache === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:121: characters 4-12
			return $v;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:122: characters 3-38
		$v1 = $this->doSerialize($name, $cache->v);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:125: characters 3-11
		return $v1;
	}

	/**
	 * @param object $x
	 * @param bool $lock
	 * 
	 * @return List_hx
	 */
	public function dynamicSearch ($x, $lock = null) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:102: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:103: characters 3-26
		$s->add("SELECT * FROM ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:104: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:105: characters 3-19
		$s->add(" WHERE ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:106: characters 3-20
		$this->addCondition($s, $x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:107: characters 3-42
		return $this->unsafeObjects($s->b, $lock);
	}

	/**
	 * Remove the cached value for the given Object field : this will ensure
	 * that the value is updated when calling .update(). This is necessary if
	 * you are modifying binary data in-place since the cache will be modified
	 * as well.
	 * 
	 * @param mixed $o
	 * @param string $field
	 * 
	 * @return void
	 */
	public function forceUpdate ($o, $field) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:588: characters 3-60
		\Reflect::setField(\Reflect::field($o, "__cache__"), $field, null);
	}

	/**
	 * @return Connection
	 */
	public function getCnx () {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:573: characters 3-13
		return Manager::$cnx;
	}

	/**
	 * @param mixed $x
	 * @param bool $lock
	 * 
	 * @return mixed
	 */
	public function getFromCache ($x, $lock) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:669: characters 21-54
		$_this = Manager::$object_cache;
		$key = $this->makeCacheKey($x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:669: characters 3-55
		$c = ($_this->data[$key] ?? null);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:670: lines 670-690
		if (($c !== null) && $lock && !Boot::dynamicField($c, '_lock')) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:672: lines 672-673
			$_g = 0;
			$_g1 = \Reflect::fields($c);
			while ($_g < $_g1->length) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:672: characters 9-10
				$f = ($_g1->arr[$_g] ?? null);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:672: lines 672-673
				++$_g;
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:673: characters 5-29
				\Reflect::deleteField($c, $f);
			}

			#/home/bubar/projects/spod/src/sys/db/Manager.hx:674: lines 674-679
			$_g2 = 0;
			$_g3 = $this->table_infos->fields;
			while ($_g2 < $_g3->length) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:674: characters 9-10
				$f1 = ($_g3->arr[$_g2] ?? null);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:674: lines 674-679
				++$_g2;
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:676: lines 676-677
				$name = $f1->name;
				$fieldName = Manager::getFieldName($f1);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:678: characters 5-56
				\Reflect::setField($c, $fieldName, \Reflect::field($x, $name));
			}

			#/home/bubar/projects/spod/src/sys/db/Manager.hx:681: characters 4-18
			$c->_lock = true;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:684: characters 12-29
			$c->_manager = $this;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:687: characters 4-37
			\Reflect::setField($c, "__cache__", $x);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:689: characters 4-11
			$this->make($c);
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:691: characters 3-11
		return $c;
	}

	/**
	 * @param string $key
	 * 
	 * @return mixed
	 */
	public function getFromCacheKey ($key) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:665: characters 3-36
		return (Manager::$object_cache->data[$key] ?? null);
	}

	/**
	 * @return string
	 */
	public function getLockMode () {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:577: characters 3-18
		return Manager::$lockMode;
	}

	/**
	 * @param mixed $x
	 * 
	 * @return string
	 */
	public function getUpdateStatement ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:229: characters 3-12
		$this->unmake($x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:230: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:231: characters 3-19
		$s->add("UPDATE ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:232: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:233: characters 3-17
		$s->add(" SET ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:234: characters 3-44
		$cache = \Reflect::field($x, "__cache__");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:235: characters 3-19
		$mod = false;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:236: lines 236-264
		$_g = 0;
		$_g1 = $this->table_infos->fields;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:236: characters 8-9
			$f = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:236: lines 236-264
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:237: lines 237-238
			if ($this->table_keys->indexOf($f->name) >= 0) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:238: characters 5-13
				continue;
			}
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:239: lines 239-240
			$name = $f->name;
			$fieldName = Manager::getFieldName($f);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:241: characters 4-49
			$v = \Reflect::field($x, $fieldName);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:242: characters 4-49
			$vc = \Reflect::field($cache, $name);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:243: lines 243-263
			if (($cache === null) || !Boot::equal($v, $vc)) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:244: characters 13-16
				$__hx__switch = ($f->t->index);
				if ($__hx__switch === 16 || $__hx__switch === 17 || $__hx__switch === 18 || $__hx__switch === 19 || $__hx__switch === 22) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:246: characters 12-34
					$a = $v;
					$b = $vc;
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:246: lines 246-247
					if (!(($a !== $b) && (($a === null) || ($b === null) || (($a->b->s <=> $b->b->s) !== 0)))) {
						#/home/bubar/projects/spod/src/sys/db/Manager.hx:247: characters 7-15
						continue;
					}
				} else if ($__hx__switch === 30) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:249: characters 6-35
					$v = $this->doUpdateCache($x, $name, $v);
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:250: characters 11-33
					$a1 = $v;
					$b1 = $vc;
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:250: lines 250-251
					if (!(($a1 !== $b1) && (($a1 === null) || ($b1 === null) || (($a1->b->s <=> $b1->b->s) !== 0)))) {
						#/home/bubar/projects/spod/src/sys/db/Manager.hx:251: characters 7-15
						continue;
					}
				} else {
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:254: lines 254-257
				if ($mod) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:255: characters 6-17
					$s->add(", ");
				} else {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:257: characters 6-16
					$mod = true;
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:258: characters 5-28
				$s->add($this->quoteField($name));
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:259: characters 5-17
				$s->add(" = ");
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:260: characters 5-27
				$this->getCnx()->addValue($s, $v);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:261: lines 261-262
				if ($cache !== null) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:262: characters 6-36
					\Reflect::setField($cache, $name, $v);
				}
			}
		}

		#/home/bubar/projects/spod/src/sys/db/Manager.hx:265: lines 265-266
		if (!$mod) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:266: characters 4-15
			return null;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:267: characters 3-19
		$s->add(" WHERE ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:268: characters 3-15
		$this->addKeys($s, $x);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:269: characters 3-22
		return $s->b;
	}

	/**
	 * @param Bytes $a
	 * @param Bytes $b
	 * 
	 * @return bool
	 */
	public function hasBinaryChanged ($a, $b) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:216: characters 10-65
		if ($a !== $b) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:216: characters 20-65
			if (!(($a === null) || ($b === null))) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:216: characters 47-64
				return ($a->b->s <=> $b->b->s) !== 0;
			} else {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:216: characters 20-65
				return true;
			}
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:216: characters 10-65
			return false;
		}
	}

	/**
	 * @param object $r
	 * 
	 * @return void
	 */
	public function initRelation ($r) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:607: characters 3-50
		$spod = \Type::resolveClass($r->type);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:608: characters 3-27
		if ($spod === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:608: characters 22-27
			throw new HxException("Missing spod type " . ($r->type??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:609: characters 3-49
		$manager = Boot::dynamicField($spod, 'manager');
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:610: characters 3-27
		$hprop = "__" . ($r->prop??'null');
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:611: characters 3-20
		$hkey = $r->key;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:612: characters 3-21
		$lock = $r->lock;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:613: characters 3-60
		if (($manager === null) || ($manager->table_keys === null)) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:613: characters 55-60
			throw new HxException("Invalid manager for relation " . ($this->table_name??'null') . ":" . ($r->prop??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:614: characters 3-45
		if ($manager->table_keys->length !== 1) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:614: characters 40-45
			throw new HxException("Relation " . ($r->prop??'null') . "(" . ($r->key??'null') . ") on a multiple key table");
		}
	}

	/**
	 * @param RecordType $t
	 * 
	 * @return bool
	 */
	public function isBinary ($t) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:208: lines 208-212
		$__hx__switch = ($t->index);
		if ($__hx__switch === 16 || $__hx__switch === 17 || $__hx__switch === 18 || $__hx__switch === 19 || $__hx__switch === 22) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:209: characters 73-77
			return true;
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:211: characters 13-18
			return false;
		}
	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function make ($x) {
	}

	/**
	 * @param mixed $x
	 * 
	 * @return string
	 */
	public function makeCacheKey ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:638: lines 638-643
		if ($this->table_keys->length === 1) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:639: characters 4-43
			$k = \Reflect::field($x, ($this->table_keys->arr[0] ?? null));
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:640: lines 640-641
			if ($k === null) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:641: characters 5-10
				throw new HxException("Missing key " . (($this->table_keys->arr[0] ?? null)??'null'));
			}
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:642: characters 4-35
			return (\Std::string($k)??'null') . ($this->table_name??'null');
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:644: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:645: lines 645-651
		$_g = 0;
		$_g1 = $this->table_keys;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:645: characters 8-9
			$k1 = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:645: lines 645-651
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:646: characters 4-31
			$v = \Reflect::field($x, $k1);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:647: lines 647-648
			if ($k1 === null) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:648: characters 5-10
				throw new HxException("Missing key " . ($k1??'null'));
			}
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:649: characters 4-12
			$s->add($v);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:650: characters 4-14
			$s->add("#");
		}

		#/home/bubar/projects/spod/src/sys/db/Manager.hx:652: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:653: characters 3-22
		return $s->b;
	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function normalizeCache ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:348: lines 348-387
		$_g = 0;
		$_g1 = \Reflect::fields($x);
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:348: characters 8-9
			$f = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:348: lines 348-387
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:350: characters 4-76
			$val = \Reflect::field($x, $f);
			$info = ($this->table_infos->hfields->data[$f] ?? null);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:351: lines 351-386
			if ($info !== null) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:353: lines 353-384
				if ($val !== null) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:353: characters 30-36
					$__hx__switch = ($info->t->index);
					if ($__hx__switch === 7) {
						#/home/bubar/projects/spod/src/sys/db/Manager.hx:381: lines 381-383
						if (Boot::is($val, Boot::getClass('String'))) {
							#/home/bubar/projects/spod/src/sys/db/Manager.hx:382: characters 7-32
							$val = \Std::parseFloat($val);
						}
					} else if ($__hx__switch === 8) {
						#/home/bubar/projects/spod/src/sys/db/Manager.hx:374: lines 374-383
						if (!Boot::is($val, Boot::getClass('Bool'))) {
							#/home/bubar/projects/spod/src/sys/db/Manager.hx:375: lines 375-380
							if (Boot::is($val, Boot::getClass('Int'))) {
								#/home/bubar/projects/spod/src/sys/db/Manager.hx:376: characters 8-22
								$val = !Boot::equal($val, 0);
							} else if (Boot::is($val, Boot::getClass('String'))) {
								#/home/bubar/projects/spod/src/sys/db/Manager.hx:377: characters 45-62
								$__hx__switch = (HxDynamicStr::wrap($val)->toLowerCase());
								if ($__hx__switch === "1" || $__hx__switch === "true") {
									#/home/bubar/projects/spod/src/sys/db/Manager.hx:378: characters 26-36
									$val = true;
								} else if ($__hx__switch === "0" || $__hx__switch === "false") {
									#/home/bubar/projects/spod/src/sys/db/Manager.hx:379: characters 27-38
									$val = false;
								}
							}
						}
					} else if ($__hx__switch === 9 || $__hx__switch === 13 || $__hx__switch === 14 || $__hx__switch === 15) {
						#/home/bubar/projects/spod/src/sys/db/Manager.hx:367: lines 367-383
						if (!Boot::is($val, Boot::getClass('String'))) {
							#/home/bubar/projects/spod/src/sys/db/Manager.hx:368: characters 7-21
							$val = (\Std::string($val)??'null') . "";
						}
					} else if ($__hx__switch === 10 || $__hx__switch === 11) {
						#/home/bubar/projects/spod/src/sys/db/Manager.hx:354: lines 354-383
						if (!($val instanceof \Date)) {
							#/home/bubar/projects/spod/src/sys/db/Manager.hx:355: lines 355-364
							if (Boot::is($val, Boot::getClass('Float'))) {
								#/home/bubar/projects/spod/src/sys/db/Manager.hx:357: characters 8-32
								$val = \Date::fromTime($val);
							} else {
								#/home/bubar/projects/spod/src/sys/db/Manager.hx:359: characters 8-25
								$v = (\Std::string($val)??'null') . "";
								#/home/bubar/projects/spod/src/sys/db/Manager.hx:360: characters 8-35
								$index = HxString::indexOf($v, ".");
								#/home/bubar/projects/spod/src/sys/db/Manager.hx:361: lines 361-362
								if ($index >= 0) {
									#/home/bubar/projects/spod/src/sys/db/Manager.hx:362: characters 9-30
									$v = mb_substr($v, 0, $index);
								}
								#/home/bubar/projects/spod/src/sys/db/Manager.hx:363: characters 8-32
								$val = \Date::fromString($v);
							}
						}
					} else if ($__hx__switch === 16 || $__hx__switch === 17 || $__hx__switch === 18 || $__hx__switch === 19 || $__hx__switch === 30) {
						#/home/bubar/projects/spod/src/sys/db/Manager.hx:365: lines 365-383
						if (Boot::is($val, Boot::getClass('String'))) {
							#/home/bubar/projects/spod/src/sys/db/Manager.hx:366: characters 13-40
							$s = $val;
							$val1 = strlen($s);
							$val = new Bytes($val1, new Container($s));
						}
					} else {
					}
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:385: characters 5-32
				\Reflect::setField($x, $f, $val);
			}
		}
	}

	/**
	 * @param mixed $it
	 * 
	 * @return string
	 */
	public function objectToString ($it) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:296: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:297: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:298: lines 298-314
		if ($this->table_keys->length === 1) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:299: characters 4-14
			$s->add("#");
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:300: characters 4-42
			$s->add(\Reflect::field($it, ($this->table_keys->arr[0] ?? null)));
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:302: characters 4-14
			$s->add("(");
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:303: characters 4-21
			$first = true;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:304: lines 304-312
			$_g = 0;
			$_g1 = $this->table_keys;
			while ($_g < $_g1->length) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:304: characters 9-10
				$f = ($_g1->arr[$_g] ?? null);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:304: lines 304-312
				++$_g;
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:305: lines 305-308
				if ($first) {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:306: characters 6-19
					$first = false;
				} else {
					#/home/bubar/projects/spod/src/sys/db/Manager.hx:308: characters 6-16
					$s->add(",");
				}
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:309: characters 5-25
				$s->add($this->quoteField($f));
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:310: characters 5-15
				$s->add(":");
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:311: characters 5-31
				$s->add(\Reflect::field($it, $f));
			}

			#/home/bubar/projects/spod/src/sys/db/Manager.hx:313: characters 4-14
			$s->add(")");
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:315: characters 3-22
		return $s->b;
	}

	/**
	 * @param string $s
	 * 
	 * @return string
	 */
	public function quote ($s) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:111: characters 3-29
		return $this->getCnx()->quote($s);
	}

	/**
	 * @param string $f
	 * 
	 * @return string
	 */
	public function quoteField ($f) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:421: characters 10-42
		$_this = Manager::$KEYWORDS;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:421: characters 10-58
		if (array_key_exists(mb_strtolower($f), $_this->data)) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:421: characters 45-54
			return "`" . ($f??'null') . "`";
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:421: characters 57-58
			return $f;
		}
	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function removeFromCache ($x) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:661: characters 3-39
		Manager::$object_cache->remove($this->makeCacheKey($x));
	}

	/**
	 * @param mixed $x
	 * 
	 * @return void
	 */
	public function unmake ($x) {
	}

	/**
	 * @param string $sql
	 * 
	 * @return int
	 */
	public function unsafeCount ($sql) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:484: characters 3-44
		return $this->unsafeExecute($sql)->getIntResult(0);
	}

	/**
	 * @param string $sql
	 * 
	 * @return void
	 */
	public function unsafeDelete ($sql) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:488: characters 3-21
		$this->unsafeExecute($sql);
	}

	/**
	 * @param string $sql
	 * 
	 * @return ResultSet
	 */
	public function unsafeExecute ($sql) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:441: characters 3-31
		return $this->getCnx()->request($sql);
	}

	/**
	 * @param mixed $id
	 * @param bool $lock
	 * 
	 * @return mixed
	 */
	public function unsafeGet ($id, $lock = null) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:492: characters 3-33
		if ($lock === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:492: characters 22-33
			$lock = true;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:493: lines 493-494
		if ($this->table_keys->length !== 1) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:494: characters 4-9
			throw new HxException("Invalid number of keys");
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:495: lines 495-496
		if ($id === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:496: characters 4-15
			return null;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:497: characters 3-66
		$x = $this->getFromCacheKey((\Std::string($id)??'null') . ($this->table_name??'null'));
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:498: lines 498-499
		if (($x !== null) && (!$lock || Boot::dynamicField($x, '_lock'))) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:499: characters 4-12
			return $x;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:500: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:501: characters 3-26
		$s->add("SELECT * FROM ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:502: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:503: characters 3-19
		$s->add(" WHERE ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:504: characters 3-35
		$s->add($this->quoteField(($this->table_keys->arr[0] ?? null)));
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:505: characters 3-15
		$s->add(" = ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:506: characters 3-26
		$this->getCnx()->addValue($s, $id);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:507: characters 3-42
		return $this->unsafeObject($s->b, $lock);
	}

	/**
	 * @param mixed $o
	 * 
	 * @return mixed
	 */
	public function unsafeGetId ($o) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:524: characters 10-60
		if ($o === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:524: characters 22-26
			return null;
		} else {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:524: characters 29-60
			return \Reflect::field($o, ($this->table_keys->arr[0] ?? null));
		}
	}

	/**
	 * @param object $keys
	 * @param bool $lock
	 * 
	 * @return mixed
	 */
	public function unsafeGetWithKeys ($keys, $lock = null) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:511: characters 3-33
		if ($lock === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:511: characters 22-33
			$lock = true;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:512: characters 3-62
		$x = $this->getFromCacheKey($this->makeCacheKey($keys));
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:513: lines 513-514
		if (($x !== null) && (!$lock || Boot::dynamicField($x, '_lock'))) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:514: characters 4-12
			return $x;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:515: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:516: characters 3-26
		$s->add("SELECT * FROM ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:517: characters 3-20
		$s->add($this->table_name);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:518: characters 3-19
		$s->add(" WHERE ");
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:519: characters 3-18
		$this->addKeys($s, $keys);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:520: characters 3-41
		return $this->unsafeObject($s->b, $lock);
	}

	/**
	 * @param string $sql
	 * @param bool $lock
	 * 
	 * @return mixed
	 */
	public function unsafeObject ($sql, $lock) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:445: lines 445-448
		if ($lock !== false) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:446: characters 4-15
			$lock = true;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:447: characters 4-24
			$sql = ($sql??'null') . ($this->getLockMode()??'null');
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:449: characters 3-30
		$r = $this->unsafeExecute($sql);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:450: characters 3-41
		$r1 = ($r->hasNext() ? $r->next() : null);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:451: lines 451-452
		if ($r1 === null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:452: characters 4-15
			return null;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:453: characters 3-20
		$this->normalizeCache($r1);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:454: characters 3-32
		$c = $this->getFromCache($r1, $lock);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:455: lines 455-456
		if ($c !== null) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:456: characters 4-12
			return $c;
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:457: characters 3-26
		$r1 = $this->cacheObject($r1, $lock);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:458: characters 3-10
		$this->make($r1);
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:459: characters 3-11
		return $r1;
	}

	/**
	 * @param string $sql
	 * @param bool $lock
	 * 
	 * @return List_hx
	 */
	public function unsafeObjects ($sql, $lock) {
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:463: lines 463-466
		if ($lock !== false) {
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:464: characters 4-8
			$lock = true;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:465: characters 4-24
			$sql = ($sql??'null') . ($this->getLockMode()??'null');
		}
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:467: characters 3-40
		$l = $this->unsafeExecute($sql)->results();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:468: characters 3-26
		$l2 = new List_hx();
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:469: characters 13-14
		$_g_head = $l->h;
		#/home/bubar/projects/spod/src/sys/db/Manager.hx:469: lines 469-479
		while ($_g_head !== null) {
			$val = $_g_head->item;
			$_g_head = $_g_head->next;
			$x = $val;
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:470: characters 4-21
			$this->normalizeCache($x);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:471: characters 4-33
			$c = $this->getFromCache($x, $lock);
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:472: lines 472-478
			if ($c !== null) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:473: characters 5-14
				$l2->add($c);
			} else {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:475: characters 5-6
				$x = $this->cacheObject($x, $lock);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:476: characters 5-12
				$this->make($x);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:477: characters 5-14
				$l2->add($x);
			}
		}

		#/home/bubar/projects/spod/src/sys/db/Manager.hx:480: characters 3-12
		return $l2;
	}

	/**
	 * @internal
	 * @access private
	 */
	static public function __hx__init ()
	{
		static $called = false;
		if ($called) return;
		$called = true;


		self::$object_cache = new StringMap();
		self::$init_list = new List_hx();
		$h = new StringMap();
		{
			#/home/bubar/projects/spod/src/sys/db/Manager.hx:45: lines 45-46
			$_g = 0;
			$_g1 = HxString::split("ADD|ALL|ALTER|ANALYZE|AND|AS|ASC|ASENSITIVE|BEFORE|BETWEEN|BIGINT|BINARY|BLOB|BOTH|BY|CALL|CASCADE|CASE|CHANGE|CHAR|CHARACTER|CHECK|COLLATE|COLUMN|CONDITION|CONSTRAINT|CONTINUE|CONVERT|CREATE|CROSS|CURRENT_DATE|CURRENT_TIME|CURRENT_TIMESTAMP|CURRENT_USER|CURSOR|DATABASE|DATABASES|DAY_HOUR|DAY_MICROSECOND|DAY_MINUTE|DAY_SECOND|DEC|DECIMAL|DECLARE|DEFAULT|DELAYED|DELETE|DESC|DESCRIBE|DETERMINISTIC|DISTINCT|DISTINCTROW|DIV|DOUBLE|DROP|DUAL|EACH|ELSE|ELSEIF|ENCLOSED|ESCAPED|EXISTS|EXIT|EXPLAIN|FALSE|FETCH|FLOAT|FLOAT4|FLOAT8|FOR|FORCE|FOREIGN|FROM|FULLTEXT|GRANT|GROUP|HAVING|HIGH_PRIORITY|HOUR_MICROSECOND|HOUR_MINUTE|HOUR_SECOND|IF|IGNORE|IN|INDEX|INFILE|INNER|INOUT|INSENSITIVE|INSERT|INT|INT1|INT2|INT3|INT4|INT8|INTEGER|INTERVAL|INTO|IS|ITERATE|JOIN|KEY|KEYS|KILL|LEADING|LEAVE|LEFT|LIKE|LIMIT|LINES|LOAD|LOCALTIME|LOCALTIMESTAMP|LOCK|LONG|LONGBLOB|LONGTEXT|LOOP|LOW_PRIORITY|MATCH|MEDIUMBLOB|MEDIUMINT|MEDIUMTEXT|MIDDLEINT|MINUTE_MICROSECOND|MINUTE_SECOND|MOD|MODIFIES|NATURAL|NOT|NO_WRITE_TO_BINLOG|NULL|NUMERIC|ON|OPTIMIZE|OPTION|OPTIONALLY|OR|ORDER|OUT|OUTER|OUTFILE|PRECISION|PRIMARY|PROCEDURE|PURGE|READ|READS|REAL|REFERENCES|REGEXP|RELEASE|RENAME|REPEAT|REPLACE|REQUIRE|RESTRICT|RETURN|REVOKE|RIGHT|RLIKE|SCHEMA|SCHEMAS|SECOND_MICROSECOND|SELECT|SENSITIVE|SEPARATOR|SET|SHOW|SMALLINT|SONAME|SPATIAL|SPECIFIC|SQL|SQLEXCEPTION|SQLSTATE|SQLWARNING|SQL_BIG_RESULT|SQL_CALC_FOUND_ROWS|SQL_SMALL_RESULT|SSL|STARTING|STRAIGHT_JOIN|TABLE|TERMINATED|THEN|TINYBLOB|TINYINT|TINYTEXT|TO|TRAILING|TRIGGER|TRUE|UNDO|UNION|UNIQUE|UNLOCK|UNSIGNED|UPDATE|USAGE|USE|USING|UTC_DATE|UTC_TIME|UTC_TIMESTAMP|VALUES|VARBINARY|VARCHAR|VARCHARACTER|VARYING|WHEN|WHERE|WHILE|WITH|WRITE|XOR|YEAR_MONTH|ZEROFILL|ASENSITIVE|CALL|CONDITION|CONNECTION|CONTINUE|CURSOR|DECLARE|DETERMINISTIC|EACH|ELSEIF|EXIT|FETCH|GOTO|INOUT|INSENSITIVE|ITERATE|LABEL|LEAVE|LOOP|MODIFIES|OUT|READS|RELEASE|REPEAT|RETURN|SCHEMA|SCHEMAS|SENSITIVE|SPECIFIC|SQL|SQLEXCEPTION|SQLSTATE|SQLWARNING|TRIGGER|UNDO|UPGRADE|WHILE", "|");
			while ($_g < $_g1->length) {
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:45: characters 8-9
				$k = ($_g1->arr[$_g] ?? null);
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:45: lines 45-46
				++$_g;
				#/home/bubar/projects/spod/src/sys/db/Manager.hx:46: characters 4-31
				$key = mb_strtolower($k);
				$h->data[$key] = true;

			}
		};
		self::$KEYWORDS = $h;
	}
}

Boot::registerClass(Manager::class, 'sys.db.Manager');
Boot::registerSetters('sys\\db\\Manager', [
	'cnx' => true
]);
Manager::__hx__init();
