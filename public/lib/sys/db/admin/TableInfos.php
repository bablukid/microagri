<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace sys\db\admin;

use \php\_Boot\HxAnon;
use \php\Boot;
use \haxe\CallStack;
use \sys\db\Object_hx;
use \sys\db\Manager;
use \haxe\rtti\Meta;
use \sys\db\RecordType;
use \php\_Boot\HxString;
use \haxe\ds\StringMap;
use \haxe\ds\List_hx;
use \haxe\Unserializer;
use \php\_Boot\HxException;
use \php\_NativeIndexedArray\NativeIndexedArrayIterator;

class TableInfos {
	/**
	 * @var string
	 */
	static public $ENGINE = "InnoDB";
	/**
	 * @var bool
	 */
	static public $OLD_COMPAT = false;

	/**
	 * @var Class
	 */
	public $cl;
	/**
	 * @var string
	 */
	public $className;
	/**
	 * @var List_hx
	 */
	public $fields;
	/**
	 * @var StringMap
	 */
	public $hfields;
	/**
	 * @var List_hx
	 */
	public $indexes;
	/**
	 * @var Manager
	 */
	public $manager;
	/**
	 * @var string
	 */
	public $name;
	/**
	 * @var StringMap
	 */
	public $nulls;
	/**
	 * @var List_hx
	 */
	public $primary;
	/**
	 * @var \Array_hx
	 */
	public $relations;

	/**
	 * @return string
	 */
	static public function allTablesRequest () {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:556: characters 3-23
		return "SHOW TABLES";
	}

	/**
	 * @param object $m
	 * @param int $max
	 * 
	 * @return string
	 */
	static public function countRequest ($m, $max) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:210: characters 3-109
		return "SELECT " . ($m->quoteField(($m->table_keys->arr[0] ?? null))??'null') . " FROM " . ($m->quoteField($m->table_name)??'null') . " LIMIT " . ($max??'null');
	}

	/**
	 * @param string $desc
	 * 
	 * @return object
	 */
	static public function fromDescription ($desc) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:480: characters 3-114
		$r = new \EReg("^CREATE TABLE `([^`]*)` \\((.*)\\)( ENGINE=([^ ]+))?( AUTO_INCREMENT=[^ ]+)?( DEFAULT CHARSET=.*)?\$", "sm");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:481: lines 481-482
		if (!$r->match($desc)) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:482: characters 4-9
			throw new HxException("Invalid " . ($desc??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:483: characters 3-28
		$tname = $r->matched(1);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:484: lines 484-485
		if (mb_strtoupper($r->matched(4)) !== "INNODB") {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:485: characters 4-9
			throw new HxException("Table " . ($tname??'null') . " should be INNODB");
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:486: characters 3-43
		$matches = HxString::split($r->matched(2), ",\x0A");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:487: characters 3-42
		$field_r = new \EReg("^[ \x0D\x0A]*`(.*)` (.*)\$", "");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:488: characters 3-62
		$primary_r = new \EReg("^[ \x0D\x0A]*PRIMARY KEY +\\((.*)\\)[ \x0D\x0A]*\$", "");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:489: characters 3-68
		$index_r = new \EReg("^[ \x0D\x0A]*(UNIQUE )?KEY `(.*)` \\((.*)\\)[ \x0D\x0A]*\$", "");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:490: characters 3-139
		$foreign_r = new \EReg("^[ \x0D\x0A]*CONSTRAINT `(.*)` FOREIGN KEY \\(`(.*)`\\) REFERENCES `(.*)` \\(`(.*)`\\) ON DELETE (SET NULL|CASCADE)[ \x0D\x0A]*\$", "");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:491: characters 3-49
		$index_key_r = new \EReg("^`?(.*?)`?(\\([0-9+]\\))?\$", "");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:492: characters 3-26
		$fields = new StringMap();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:493: characters 3-25
		$nulls = new StringMap();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:494: characters 3-27
		$indexes = new StringMap();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:495: characters 3-31
		$relations = new \Array_hx();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:496: characters 3-22
		$primary = null;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:497: lines 497-532
		$_g = 0;
		while ($_g < $matches->length) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:497: characters 8-9
			$f = ($matches->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:497: lines 497-532
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:498: lines 498-531
			if ($field_r->match($f)) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:499: characters 5-36
				$fname = $field_r->matched(1);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:500: characters 5-57
				$ftype = TableInfos::fromTypeDescription($field_r->matched(2));
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:501: lines 501-502
				if ($ftype === null) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:502: characters 6-11
					throw new HxException("Unknown description '" . ($field_r->matched(2)??'null') . "'");
				}
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:503: characters 5-30
				$fields->data[$fname] = $ftype->t;
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:504: lines 504-505
				if ($ftype->nullable) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:505: characters 6-27
					$nulls->data[$fname] = true;
				}
			} else if ($primary_r->match($f)) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:507: lines 507-508
				if ($primary !== null) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:508: characters 6-11
					throw new HxException("Duplicate primary key");
				}
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:509: characters 5-46
				$primary = HxString::split($primary_r->matched(1), ",");
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:510: lines 510-513
				$_g1 = 0;
				$_g11 = $primary->length;
				while ($_g1 < $_g11) {
					$i = $_g1++;
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:511: characters 6-35
					$k = TableInfos::unescape(($primary->arr[$i] ?? null));
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:512: characters 6-20
					$primary[$i] = $k;
				}

			} else if ($index_r->match($f)) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:515: characters 5-37
				$unique = $index_r->matched(1);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:516: characters 5-38
				$idxname = $index_r->matched(2);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:517: characters 5-57
				$fs = \Lambda::list(HxString::split($index_r->matched(3), ","));
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:518: lines 518-521
				$value = $fs->map(function ($r1)  use (&$index_key_r) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:519: characters 6-39
					if (!$index_key_r->match($r1)) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:519: characters 34-39
						throw new HxException("Invalid index key " . ($r1??'null'));
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:520: characters 6-35
					return $index_key_r->matched(1);
				});
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:518: lines 518-521
				$indexes->data[$idxname] = new HxAnon([
					"keys" => $value,
					"unique" => ($unique !== "") && ($unique !== null),
					"name" => $idxname,
				]);

			} else if ($foreign_r->match($f)) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:523: characters 5-37
				$name = $foreign_r->matched(1);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:524: characters 5-36
				$key = $foreign_r->matched(2);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:525: characters 5-38
				$table = $foreign_r->matched(3);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:526: characters 5-62
				$table = (mb_strtoupper(mb_substr($table, 0, 1))??'null') . (mb_substr($table, 1, null)??'null');
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:527: characters 5-35
				$id = $foreign_r->matched(4);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:528: characters 5-75
				$setnull = ($foreign_r->matched(5) === "SET NULL" ? true : null);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:529: characters 5-90
				$relations->arr[$relations->length] = new HxAnon([
					"name" => $name,
					"key" => $key,
					"table" => $table,
					"id" => $id,
					"setnull" => $setnull,
				]);
				++$relations->length;

			} else {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:531: characters 5-10
				throw new HxException("Invalid " . ($f??'null') . " in " . ($desc??'null'));
			}
		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:533: lines 533-540
		return new HxAnon([
			"table" => $tname,
			"fields" => $fields,
			"nulls" => $nulls,
			"indexes" => $indexes,
			"relations" => $relations,
			"primary" => $primary,
		]);
	}

	/**
	 * @param string $desc
	 * 
	 * @return object
	 */
	static public function fromTypeDescription ($desc) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:370: characters 3-45
		$fdesc = HxString::split(mb_strtoupper($desc), " ");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:371: characters 15-28
		if ($fdesc->length > 0) {
			$fdesc->length--;
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:371: characters 3-29
		$ftype = array_shift($fdesc->arr);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:372: characters 3-45
		$tparam = new \EReg("^([A-Za-z]+)\\(([0-9]+)\\)\$", "");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:373: characters 3-20
		$param = null;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:374: lines 374-377
		if ($tparam->match($ftype)) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:375: characters 4-29
			$ftype = $tparam->matched(1);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:376: characters 4-43
			$param = \Std::parseInt($tparam->matched(2));
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:378: characters 3-23
		$nullable = true;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:379: lines 379-436
		$t = null;
		if ($ftype === null) {
			$t = null;
		} else {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:379: characters 19-24
			if ($ftype === "BIGINT") {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:379: lines 379-436
				$t = ($fdesc->remove("AUTO_INCREMENT") ? RecordType::DBigId() : RecordType::DBigInt());
			} else if ($ftype === "BINARY") {
				$t = ($param === null ? null : RecordType::DBytes($param));
			} else if ($ftype === "BLOB") {
				$t = RecordType::DSmallBinary();
			} else if ($ftype === "DATE") {
				$t = RecordType::DDate();
			} else if ($ftype === "DATETIME") {
				$t = RecordType::DDateTime();
			} else if ($ftype === "DOUBLE") {
				$t = RecordType::DFloat();
			} else if ($ftype === "FLOAT") {
				$t = RecordType::DSingle();
			} else if ($ftype === "INT") {
				$t = (($param === 11) && $fdesc->remove("AUTO_INCREMENT") ? RecordType::DId() : (($param === 10) && $fdesc->remove("UNSIGNED") ? ($fdesc->remove("AUTO_INCREMENT") ? RecordType::DUId() : RecordType::DUInt()) : ($param === 11 ? RecordType::DInt() : null)));
			} else if ($ftype === "LONGBLOB") {
				$t = RecordType::DLongBinary();
			} else if ($ftype === "MEDIUMBLOB") {
				$t = RecordType::DBinary();
			} else if ($ftype === "MEDIUMINT") {
				$t = ($fdesc->remove("UNSIGNED") ? RecordType::DMediumUInt() : RecordType::DMediumInt());
			} else if ($ftype === "MEDIUMTEXT") {
				$t = RecordType::DText();
			} else if ($ftype === "SMALLINT") {
				$t = ($fdesc->remove("UNSIGNED") ? RecordType::DSmallUInt() : RecordType::DSmallInt());
			} else if ($ftype === "TEXT") {
				$t = RecordType::DSmallText();
			} else if ($ftype === "TIMESTAMP") {
				$t = RecordType::DTimeStamp();
			} else if ($ftype === "TINYINT") {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:411: lines 411-424
				if ($param === null) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:379: lines 379-436
					$t = (TableInfos::$OLD_COMPAT ? RecordType::DInt() : null);
				} else {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:411: characters 12-17
					if ($param === 1) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:413: characters 5-29
						$fdesc->remove("UNSIGNED");
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:379: lines 379-436
						$t = RecordType::DBool();
					} else if ($param === 3) {
						$t = ($fdesc->remove("UNSIGNED") ? RecordType::DTinyUInt() : null);
					} else if ($param === 4) {
						$t = RecordType::DTinyInt();
					} else {
						$t = (TableInfos::$OLD_COMPAT ? RecordType::DInt() : null);
					}
				}
			} else if ($ftype === "TINYTEXT") {
				$t = RecordType::DTinyText();
			} else if ($ftype === "CHAR" || $ftype === "VARCHAR") {
				$t = ($param === null ? null : RecordType::DString($param));
			} else {
				$t = null;
			}
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:437: lines 437-438
		if ($t === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:438: characters 4-15
			return null;
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:439: lines 439-475
		while ($fdesc->length > 0) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:440: characters 12-25
			if ($fdesc->length > 0) {
				$fdesc->length--;
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:440: characters 4-26
			$d = array_shift($fdesc->arr);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:441: lines 441-474
			if ($d === null) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:473: characters 5-16
				return null;
			} else {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:441: characters 12-13
				if ($d === "DEFAULT") {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:447: characters 13-26
					if ($fdesc->length > 0) {
						$fdesc->length--;
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:447: characters 5-27
					$v = array_shift($fdesc->arr);
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:448: lines 448-452
					if ($nullable) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:449: lines 449-450
						if ($v === "NULL") {
							#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:450: characters 7-15
							continue;
						}
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:451: characters 6-17
						return null;
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:453: lines 453-465
					$def = null;
					$__hx__switch = ($t->index);
					if ($__hx__switch === 0 || $__hx__switch === 1 || $__hx__switch === 2 || $__hx__switch === 3 || $__hx__switch === 4 || $__hx__switch === 5 || $__hx__switch === 6 || $__hx__switch === 7 || $__hx__switch === 8 || $__hx__switch === 20 || $__hx__switch === 23 || $__hx__switch === 24) {
						$def = "'0'";
					} else if ($__hx__switch === 10) {
						$def = "'0000-00-00'";
					} else if ($__hx__switch === 11 || $__hx__switch === 12) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:458: characters 10-53
						$def1 = null;
						if (mb_strlen($v) > 0) {
							#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:458: characters 26-46
							$index = mb_strlen($v) - 1;
							#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:458: characters 10-53
							$def1 = (($index < 0 ? "" : mb_substr($v, $index, 1))) !== "'";
						} else {
							$def1 = false;
						}
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:458: lines 458-459
						if ($def1) {
							#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:459: characters 16-29
							if ($fdesc->length > 0) {
								$fdesc->length--;
							}
							#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:459: characters 7-29
							$v = ($v??'null') . " " . (array_shift($fdesc->arr)??'null');
						}
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:453: lines 453-465
						$def = "'0000-00-00 00:00:00'";
					} else if ($__hx__switch === 9 || $__hx__switch === 13 || $__hx__switch === 14 || $__hx__switch === 15 || $__hx__switch === 21) {
						$def = "''";
					} else if ($__hx__switch === 16 || $__hx__switch === 17 || $__hx__switch === 18 || $__hx__switch === 19 || $__hx__switch === 22 || $__hx__switch === 32 || $__hx__switch === 33) {
						$def = null;
					} else if ($__hx__switch === 25 || $__hx__switch === 26 || $__hx__switch === 27 || $__hx__switch === 28 || $__hx__switch === 29) {
						$def = "'0'";
					} else if ($__hx__switch === 30) {
						$def = null;
					} else if ($__hx__switch === 31) {
						$def = "'0'";
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:466: lines 466-467
					if (($v !== $def) && !TableInfos::$OLD_COMPAT) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:467: characters 6-17
						return null;
					}
				} else if ($d === "NOT") {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:443: characters 9-22
					if ($fdesc->length > 0) {
						$fdesc->length--;
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:443: lines 443-444
					if (array_shift($fdesc->arr) !== "NULL") {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:444: characters 6-17
						return null;
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:445: characters 5-21
					$nullable = false;
				} else if ($d === "NULL") {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:469: characters 5-32
					if (!$nullable) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:469: characters 21-32
						return null;
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:470: characters 5-20
					$nullable = true;
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:471: characters 5-13
					continue;
				} else {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:473: characters 5-16
					return null;
				}
			}
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:476: characters 3-40
		return new HxAnon([
			"t" => $t,
			"nullable" => $nullable,
		]);
	}

	/**
	 * @param RecordType $dt
	 * @param RecordType $rt
	 * 
	 * @return bool
	 */
	static public function sameDBStorage ($dt, $rt) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:544: lines 544-552
		$__hx__switch = ($rt->index);
		if ($__hx__switch === 20) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:545: characters 18-28
			return $dt === RecordType::DInt();
		} else if ($__hx__switch === 21) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:547: characters 21-34
			return $dt === RecordType::DText();
		} else if ($__hx__switch === 22) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:548: characters 25-40
			return $dt === RecordType::DBinary();
		} else if ($__hx__switch === 23) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 19-23
			$auto = $rt->params[1];
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 15-17
			$fl = $rt->params[0];
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 26-174
			if ($auto) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 33-159
				if ($fl->length <= 8) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 51-66
					return $dt === RecordType::DTinyUInt();
				} else if ($fl->length <= 16) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 88-104
					return $dt === RecordType::DSmallUInt();
				} else if ($fl->length <= 24) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 126-143
					return $dt === RecordType::DMediumUInt();
				} else {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 146-156
					return $dt === RecordType::DInt();
				}
			} else {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:546: characters 162-174
				return $dt === RecordType::DInt();
			}
		} else if ($__hx__switch === 30) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:549: characters 15-28
			return $dt === RecordType::DBinary();
		} else if ($__hx__switch === 31) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:550: characters 18-33
			return $dt === RecordType::DTinyUInt();
		} else {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:551: characters 12-17
			return false;
		}
	}

	/**
	 * @param string $field
	 * 
	 * @return string
	 */
	static public function unescape ($field) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:117: characters 7-88
		$tmp = null;
		if ((mb_strlen($field) > 1) && (mb_substr($field, 0, 1) === "`")) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:117: characters 53-81
			$index = mb_strlen($field) - 1;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:117: characters 7-88
			$tmp = (($index < 0 ? "" : mb_substr($field, $index, 1))) === "`";
		} else {
			$tmp = false;
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:117: lines 117-118
		if ($tmp) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:118: characters 11-41
			return mb_substr($field, 1, mb_strlen($field) - 2);
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:119: characters 3-15
		return $field;
	}

	/**
	 * @param string $cname
	 * 
	 * @return void
	 */
	public function __construct ($cname) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:66: characters 3-22
		$this->hfields = new StringMap();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:67: characters 3-22
		$this->fields = new List_hx();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:68: characters 3-20
		$this->nulls = new StringMap();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:69: characters 3-43
		$this->cl = \Type::resolveClass("db." . ($cname??'null'));
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:70: lines 70-73
		if ($this->cl === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:71: characters 4-38
			$this->cl = \Type::resolveClass($cname);
		} else {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:73: characters 4-23
			$cname = "db." . ($cname??'null');
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:74: lines 74-75
		if ($this->cl === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:75: characters 4-9
			throw new HxException("Class not found : " . ($cname??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:76: characters 3-31
		$this->manager = Boot::dynamicField($this->cl, 'manager');
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:77: lines 77-78
		if ($this->manager === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:78: characters 4-9
			throw new HxException("No static manager for " . ($cname??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:79: characters 3-20
		$this->className = $cname;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:80: characters 3-71
		if (mb_substr($this->className, 0, 3) === "db.") {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:80: characters 40-71
			$this->className = mb_substr($this->className, 3, null);
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:81: characters 3-28
		$a = HxString::split($cname, ".");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:82: characters 10-17
		if ($a->length > 0) {
			$a->length--;
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:82: characters 3-17
		$this->name = array_pop($a->arr);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:83: characters 3-17
		$this->processClass();
	}

	/**
	 * @param string $fname
	 * 
	 * @return string
	 */
	public function addFieldRequest ($fname) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:214: characters 3-34
		$ftype = ($this->hfields->data[$fname] ?? null);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:215: lines 215-216
		if ($ftype === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:216: characters 4-9
			throw new HxException("No field " . ($fname??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:217: characters 3-48
		$rq = "ALTER TABLE " . ($this->escape($this->name)??'null') . " ADD ";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:218: characters 3-75
		return ($rq??'null') . ($this->escape($fname)??'null') . " " . ($this->fieldInfos(new HxAnon([
			"name" => $fname,
			"type" => $ftype,
		]))??'null');
	}

	/**
	 * @param \Array_hx $idx
	 * @param bool $unique
	 * 
	 * @return string
	 */
	public function addIndexRequest ($idx, $unique) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:257: characters 3-26
		$eidx = new \Array_hx();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:258: lines 258-268
		$_g = 0;
		while ($_g < $idx->length) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:258: characters 8-9
			$i = ($idx->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:258: lines 258-268
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:259: characters 4-22
			$k = $this->escape($i);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:260: characters 4-27
			$f = ($this->hfields->data[$i] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:261: lines 261-266
			if ($f !== null) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:262: lines 262-266
				if ($f !== null) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:262: characters 12-13
					$__hx__switch = ($f->index);
					if ($__hx__switch === 13 || $__hx__switch === 14 || $__hx__switch === 15 || $__hx__switch === 16 || $__hx__switch === 17 || $__hx__switch === 18) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:264: characters 5-15
						$k = ($k??'null') . "(4)";
					} else {
					}
				}
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:267: characters 4-16
			$eidx->arr[$eidx->length] = $k;
			++$eidx->length;

		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:269: characters 3-133
		return "ALTER TABLE " . ($this->escape($this->name)??'null') . " ADD " . ((($unique ? "UNIQUE " : ""))??'null') . "INDEX " . ($this->escape($this->indexName($idx))??'null') . "(" . ($eidx->join(",")??'null') . ")";
	}

	/**
	 * @param string $key
	 * @param string $prop
	 * 
	 * @return string
	 */
	public function addRelationRequest ($key, $prop) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:242: lines 242-244
		$_g = 0;
		$_g1 = $this->relations;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:242: characters 8-9
			$r = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:242: lines 242-244
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:243: lines 243-244
			if (($r->key === $key) && ($r->prop === $prop)) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:244: characters 5-64
				return "ALTER TABLE " . ($this->escape($this->name)??'null') . " ADD " . ($this->relationInfos($r)??'null');
			}
		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:245: characters 10-15
		throw new HxException("No such relation : " . ($prop??'null') . "(" . ($key??'null') . ")");
	}

	/**
	 * @param bool $full
	 * 
	 * @return string
	 */
	public function createRequest ($full) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:127: characters 3-49
		$str = "CREATE TABLE " . ($this->escape($this->name)??'null') . " (\x0A";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:128: characters 14-31
		$keys_head = $this->fields->h;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:129: lines 129-134
		while ($keys_head !== null) {
			$val = $keys_head->item;
			$keys_head = $keys_head->next;
			$f = $val;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:130: characters 4-43
			$str = ($str??'null') . ($this->escape($f->name)??'null') . " " . ($this->fieldInfos($f)??'null');
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:131: lines 131-132
			if ($keys_head !== null) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:132: characters 5-15
				$str = ($str??'null') . ",";
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:133: characters 4-15
			$str = ($str??'null') . "\x0A";
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:135: lines 135-136
		if ($this->primary !== null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:136: characters 4-64
			$str = ($str??'null') . ", PRIMARY KEY (" . ($this->primary->map(Boot::getInstanceClosure($this, 'escape'))->join(",")??'null') . ")\x0A";
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:137: lines 137-143
		if ($full) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:138: lines 138-140
			$_g1 = 0;
			$_g2 = $this->relations;
			while ($_g1 < $_g2->length) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:138: characters 9-10
				$r = ($_g2->arr[$_g1] ?? null);
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:138: lines 138-140
				++$_g1;
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:139: lines 139-140
				if ($this->isRelationActive($r)) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:140: characters 6-34
					$str = ($str??'null') . ", " . ($this->relationInfos($r)??'null');
				}
			}

			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:141: characters 14-21
			$_g3_head = $this->indexes->h;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:141: lines 141-142
			while ($_g3_head !== null) {
				$val1 = $_g3_head->item;
				$_g3_head = $_g3_head->next;
				$i = $val1;
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:142: characters 5-131
				$str = ($str??'null') . ", " . ((($i->unique ? "UNIQUE " : ""))??'null') . "KEY " . ($this->escape(($this->name??'null') . "_" . ($i->keys->join("_")??'null'))??'null') . "(" . ($i->keys->map(Boot::getInstanceClosure($this, 'escape'))->join(",")??'null') . ")\x0A";
			}

		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:144: characters 3-13
		$str = ($str??'null') . ")";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:145: lines 145-146
		if (TableInfos::$ENGINE !== null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:146: characters 4-28
			$str = ($str??'null') . " ENGINE=" . (TableInfos::$ENGINE??'null');
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:147: characters 3-13
		return $str;
	}

	/**
	 * @param string $idx
	 * 
	 * @return string
	 */
	public function deleteIndexRequest ($idx) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:273: characters 3-64
		return "ALTER TABLE " . ($this->escape($this->name)??'null') . " DROP INDEX " . ($this->escape($idx)??'null');
	}

	/**
	 * @param string $rel
	 * 
	 * @return string
	 */
	public function deleteRelationRequest ($rel) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:249: characters 3-70
		return "ALTER TABLE " . ($this->escape($this->name)??'null') . " DROP FOREIGN KEY " . ($this->escape($rel)??'null');
	}

	/**
	 * @return string
	 */
	public function descriptionRequest () {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:202: characters 3-43
		return "SHOW CREATE TABLE " . ($this->escape($this->name)??'null');
	}

	/**
	 * @return string
	 */
	public function dropRequest () {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:194: characters 3-36
		return "DROP TABLE " . ($this->escape($this->name)??'null');
	}

	/**
	 * @param string $name
	 * 
	 * @return string
	 */
	public function escape ($name) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:112: characters 3-40
		$m = $this->manager;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:113: characters 3-28
		return $m->quoteField($name);
	}

	/**
	 * @return string
	 */
	public function existsRequest () {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:206: characters 3-50
		return "SELECT * FROM " . ($this->escape($this->name)??'null') . " LIMIT 0";
	}

	/**
	 * @param object $f
	 * 
	 * @return string
	 */
	public function fieldInfos ($f) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:159: lines 159-190
		$tmp = null;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:159: characters 19-25
		$_g = $f->type;
		$__hx__switch = ($_g->index);
		if ($__hx__switch === 0) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:159: lines 159-190
			$tmp = "INT AUTO_INCREMENT";
		} else if ($__hx__switch === 2) {
			$tmp = "INT UNSIGNED AUTO_INCREMENT";
		} else if ($__hx__switch === 3) {
			$tmp = "INT UNSIGNED";
		} else if ($__hx__switch === 4) {
			$tmp = "BIGINT AUTO_INCREMENT";
		} else if ($__hx__switch === 5) {
			$tmp = "BIGINT";
		} else if ($__hx__switch === 6) {
			$tmp = "FLOAT";
		} else if ($__hx__switch === 7) {
			$tmp = "DOUBLE";
		} else if ($__hx__switch === 8) {
			$tmp = "TINYINT(1)";
		} else if ($__hx__switch === 9) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:169: characters 16-17
			$n = $_g->params[0];
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:159: lines 159-190
			$tmp = "VARCHAR(" . ($n??'null') . ")";
		} else if ($__hx__switch === 10) {
			$tmp = "DATE";
		} else if ($__hx__switch === 11) {
			$tmp = "DATETIME";
		} else if ($__hx__switch === 12) {
			$tmp = "TIMESTAMP" . (((array_key_exists($f->name, $this->nulls->data) ? " NULL DEFAULT NULL" : " DEFAULT 0"))??'null');
		} else if ($__hx__switch === 13) {
			$tmp = "TINYTEXT";
		} else if ($__hx__switch === 14) {
			$tmp = "TEXT";
		} else if ($__hx__switch === 15 || $__hx__switch === 21) {
			$tmp = "MEDIUMTEXT";
		} else if ($__hx__switch === 16) {
			$tmp = "BLOB";
		} else if ($__hx__switch === 17) {
			$tmp = "LONGBLOB";
		} else if ($__hx__switch === 19) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:183: characters 15-16
			$n1 = $_g->params[0];
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:159: lines 159-190
			$tmp = "BINARY(" . ($n1??'null') . ")";
		} else if ($__hx__switch === 1 || $__hx__switch === 20) {
			$tmp = "INT";
		} else if ($__hx__switch === 18 || $__hx__switch === 22) {
			$tmp = "MEDIUMBLOB";
		} else if ($__hx__switch === 23) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:163: characters 19-23
			$auto = $_g->params[1];
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:163: characters 15-17
			$fl = $_g->params[0];
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:159: lines 159-190
			$tmp = ($auto ? ($fl->length <= 8 ? "TINYINT UNSIGNED" : ($fl->length <= 16 ? "SMALLINT UNSIGNED" : ($fl->length <= 24 ? "MEDIUMINT UNSIGNED" : "INT"))) : "INT");
		} else if ($__hx__switch === 24) {
			$tmp = "TINYINT";
		} else if ($__hx__switch === 25) {
			$tmp = "TINYINT UNSIGNED";
		} else if ($__hx__switch === 26) {
			$tmp = "SMALLINT";
		} else if ($__hx__switch === 27) {
			$tmp = "SMALLINT UNSIGNED";
		} else if ($__hx__switch === 28) {
			$tmp = "MEDIUMINT";
		} else if ($__hx__switch === 29) {
			$tmp = "MEDIUMINT UNSIGNED";
		} else if ($__hx__switch === 30) {
			$tmp = "MEDIUMBLOB";
		} else if ($__hx__switch === 31) {
			$tmp = "TINYINT UNSIGNED";
		} else if ($__hx__switch === 32 || $__hx__switch === 33) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:189: characters 26-31
			throw new HxException("assert");
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:159: lines 159-190
		return ($tmp??'null') . (((array_key_exists($f->name, $this->nulls->data) ? "" : " NOT NULL"))??'null');
	}

	/**
	 * @param string $id
	 * 
	 * @return Object_hx
	 */
	public function fromIdentifier ($id) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:305: characters 3-27
		$ids = HxString::split($id, "@");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:306: lines 306-307
		if ($this->primary === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:307: characters 4-9
			throw new HxException("No primary key");
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:308: lines 308-309
		if ($ids->length !== $this->primary->length) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:309: characters 4-9
			throw new HxException("Invalid identifier");
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:310: characters 3-17
		$keys = new HxAnon();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:311: characters 13-20
		$_g_head = $this->primary->h;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:311: lines 311-312
		while ($_g_head !== null) {
			$val = $_g_head->item;
			$_g_head = $_g_head->next;
			$p = $val;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:312: characters 46-60
			$tmp = ($this->hfields->data[$p] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:312: characters 62-73
			if ($ids->length > 0) {
				$ids->length--;
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:312: characters 4-96
			\Reflect::setField($keys, $p, $this->makeNativeValue($tmp, HxString::split(array_shift($ids->arr), "~")->join(".")));
		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:313: characters 3-41
		return $this->manager->unsafeGetWithKeys($keys);
	}

	/**
	 * @param StringMap $params
	 * @param string $order
	 * @param int $pos
	 * @param int $count
	 * 
	 * @return List_hx
	 */
	public function fromSearch ($params, $order, $pos, $count) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:331: characters 3-31
		$rop = new \EReg("^([<>]=?)(.+)\$", "");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:332: characters 3-21
		$cond = "TRUE";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:333: characters 3-40
		$m = $this->manager;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:334: characters 13-26
		$p = new NativeIndexedArrayIterator(array_map("strval", array_keys($params->data)));
		while ($p->hasNext()) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:334: lines 334-357
			$p1 = $p->next();
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:335: characters 4-27
			$f = ($this->hfields->data[$p1] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:336: characters 4-26
			$v = ($params->data[$p1] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:337: lines 337-338
			if ($f === null) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:338: characters 5-13
				continue;
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:339: characters 4-31
			$cond = ($cond??'null') . " AND " . ($this->escape($p1)??'null');
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:340: lines 340-356
			if (($v === null) || ($v === "NULL")) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:341: characters 5-23
				$cond = ($cond??'null') . " IS NULL";
			} else if ($f === null) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:355: characters 5-29
				$cond = ($cond??'null') . " = " . ($m->quote($v)??'null');
			} else {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:342: characters 17-18
				$__hx__switch = ($f->index);
				if ($__hx__switch === 8) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:348: characters 5-42
					$cond = ($cond??'null') . " = " . ((($v === "true" ? 1 : 0))??'null');
				} else if ($__hx__switch === 9 || $__hx__switch === 13 || $__hx__switch === 14 || $__hx__switch === 15) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:346: characters 5-32
					$cond = ($cond??'null') . " LIKE " . ($m->quote($v)??'null');
				} else if ($__hx__switch === 0 || $__hx__switch === 1 || $__hx__switch === 2 || $__hx__switch === 3 || $__hx__switch === 4 || $__hx__switch === 5 || $__hx__switch === 6 || $__hx__switch === 7 || $__hx__switch === 10 || $__hx__switch === 11) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:350: lines 350-353
					if ($rop->match($v)) {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:351: characters 6-60
						$cond = ($cond??'null') . " " . ($rop->matched(1)??'null') . " " . ($m->quote($rop->matched(2))??'null');
					} else {
						#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:353: characters 6-30
						$cond = ($cond??'null') . " = " . ($m->quote($v)??'null');
					}
				} else if ($__hx__switch === 20) {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:344: characters 19-60
					$cond1 = null;
					try {
						$cond1 = Id::encode($v);
					} catch (\Throwable $__hx__caught_e) {
						CallStack::saveExceptionTrace($__hx__caught_e);
						$__hx__real_e = ($__hx__caught_e instanceof HxException ? $__hx__caught_e->e : $__hx__caught_e);
						$e = $__hx__real_e;
						$cond1 = 0;
					}
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:344: characters 5-60
					$cond = ($cond??'null') . " = " . ($cond1??'null');
				} else {
					#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:355: characters 5-29
					$cond = ($cond??'null') . " = " . ($m->quote($v)??'null');
				}
			}
		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:358: lines 358-363
		if ($order !== null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:359: lines 359-362
			if (mb_substr($order, 0, 1) === "-") {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:360: characters 5-57
				$cond = ($cond??'null') . " ORDER BY " . ($this->escape(mb_substr($order, 1, null))??'null') . " DESC";
			} else {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:362: characters 5-39
				$cond = ($cond??'null') . " ORDER BY " . ($this->escape($order)??'null');
			}
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:365: characters 3-96
		$sql = "SELECT * FROM " . ($this->escape($this->name)??'null') . " WHERE " . ($cond??'null') . " LIMIT " . ($pos??'null') . "," . ($count??'null');
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:366: characters 3-43
		return $this->manager->unsafeObjects($sql, false);
	}

	/**
	 * @param Object_hx $o
	 * 
	 * @return string
	 */
	public function identifier ($o) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:299: lines 299-300
		if ($this->primary === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:300: characters 4-9
			throw new HxException("No primary key");
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:301: characters 3-108
		return $this->primary->map(function ($p)  use (&$o) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:301: characters 36-94
			return HxString::split(\Std::string(\Reflect::field($o, $p)), ".")->join("~");
		})->join("@");
	}

	/**
	 * @param \Array_hx $idx
	 * 
	 * @return string
	 */
	public function indexName ($idx) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:253: characters 3-32
		return ($this->name??'null') . "_" . ($idx->join("_")??'null');
	}

	/**
	 * @param mixed $r
	 * 
	 * @return bool
	 */
	public function isRelationActive ($r) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:123: characters 3-14
		return true;
	}

	/**
	 * @param RecordType $t
	 * @param string $v
	 * 
	 * @return mixed
	 */
	public function makeNativeValue ($t, $v) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:317: lines 317-327
		$__hx__switch = ($t->index);
		if ($__hx__switch === 0 || $__hx__switch === 1 || $__hx__switch === 2 || $__hx__switch === 3 || $__hx__switch === 20 || $__hx__switch === 23 || $__hx__switch === 24) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:318: characters 63-83
			return \Std::parseInt($v);
		} else if ($__hx__switch === 4 || $__hx__switch === 5 || $__hx__switch === 6 || $__hx__switch === 7) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:320: characters 42-64
			return \Std::parseFloat($v);
		} else if ($__hx__switch === 8) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:322: characters 15-33
			return $v === "true";
		} else if ($__hx__switch === 10 || $__hx__switch === 11 || $__hx__switch === 12) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:321: characters 38-61
			return \Date::fromString($v);
		} else if ($__hx__switch === 9 || $__hx__switch === 13 || $__hx__switch === 14 || $__hx__switch === 15 || $__hx__switch === 16 || $__hx__switch === 17 || $__hx__switch === 18 || $__hx__switch === 19 || $__hx__switch === 21 || $__hx__switch === 22) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:323: characters 127-133
			return $v;
		} else if ($__hx__switch === 25 || $__hx__switch === 26 || $__hx__switch === 27 || $__hx__switch === 28 || $__hx__switch === 29) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:319: characters 67-87
			return \Std::parseInt($v);
		} else if ($__hx__switch === 30) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:324: characters 15-21
			return $v;
		} else if ($__hx__switch === 31) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:325: characters 18-24
			return $v;
		} else if ($__hx__switch === 32 || $__hx__switch === 33) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:326: characters 26-31
			throw new HxException("assert");
		}
	}

	/**
	 * @return void
	 */
	public function processClass () {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:87: characters 3-46
		$rtti = Boot::dynamicField(Meta::getType($this->cl), 'rtti');
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:88: lines 88-89
		if ($rtti === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:89: characters 4-9
			throw new HxException("Class " . ($this->name??'null') . " does not have RTTI");
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:90: characters 3-67
		$infos = Unserializer::run(($rtti->arr[0] ?? null));
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:91: characters 3-20
		$this->name = $infos->name;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:92: characters 3-35
		$this->primary = \Lambda::list($infos->key);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:93: lines 93-97
		$_g = 0;
		$_g1 = $infos->fields;
		while ($_g < $_g1->length) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:93: characters 8-9
			$f = ($_g1->arr[$_g] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:93: lines 93-97
			++$_g;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:94: characters 4-45
			$this->fields->add(new HxAnon([
				"name" => $f->name,
				"type" => $f->t,
			]));
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:95: characters 4-28
			$this->hfields->data[$f->name] = $f->t;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:96: characters 4-42
			if ($f->isNull) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:96: characters 19-42
				$this->nulls->data[$f->name] = true;
			}
		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:98: characters 3-26
		$this->relations = new \Array_hx();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:99: lines 99-105
		$_g2 = 0;
		$_g3 = $infos->relations;
		while ($_g2 < $_g3->length) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:99: characters 8-9
			$r = ($_g3->arr[$_g2] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:99: lines 99-105
			++$_g2;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:100: characters 4-38
			$t = \Type::resolveClass($r->type);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:101: characters 4-25
			if ($t === null) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:101: characters 20-25
				throw new HxException("Missing type " . ($r->type??'null') . " for relation " . ($this->name??'null') . "." . ($r->prop??'null'));
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:102: characters 4-62
			$manager = \Reflect::field($t, "manager");
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:103: characters 4-31
			if ($manager === null) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:103: characters 26-31
				throw new HxException(($r->type??'null') . " does not have a static field manager");
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:104: characters 4-157
			$_this = $this->relations;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:104: characters 29-35
			$r1 = $r->prop;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:104: characters 43-48
			$r2 = $r->key;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:104: characters 57-63
			$r3 = $r->lock;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:104: characters 96-132
			$x = \Type::getClassName($manager->dbClass());
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:104: characters 4-157
			$_this->arr[$_this->length] = new HxAnon([
				"prop" => $r1,
				"key" => $r2,
				"lock" => $r3,
				"manager" => $manager,
				"className" => $x,
				"cascade" => $r->cascade,
			]);
			++$_this->length;

		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:106: characters 3-23
		$this->indexes = new List_hx();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:107: lines 107-108
		$_g4 = 0;
		$_g5 = $infos->indexes;
		while ($_g4 < $_g5->length) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:107: characters 8-9
			$i = ($_g5->arr[$_g4] ?? null);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:107: lines 107-108
			++$_g4;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:108: characters 4-11
			$tmp = $this->indexes;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:108: characters 27-46
			$tmp1 = \Lambda::list($i->keys);
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:108: characters 4-69
			$tmp->push(new HxAnon([
				"keys" => $tmp1,
				"unique" => $i->unique,
			]));
		}

	}

	/**
	 * @param object $r
	 * 
	 * @return string
	 */
	public function relationInfos ($r) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:151: lines 151-152
		if ($r->manager->table_keys->length !== 1) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:152: characters 4-9
			throw new HxException("Relation on a multiple-keys table");
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:153: characters 3-167
		$rq = "CONSTRAINT " . ($this->escape(($this->name??'null') . "_" . ($r->prop??'null'))??'null') . " FOREIGN KEY (" . ($this->escape($r->key)??'null') . ") REFERENCES " . ($this->escape($r->manager->table_name)??'null') . "(" . ($this->escape(($r->manager->table_keys->arr[0] ?? null))??'null') . ") ";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:154: characters 3-98
		$rq = ($rq??'null') . "ON DELETE " . (((($this->nulls->data[$r->key] ?? null) && ($r->cascade !== true) ? "SET NULL" : "CASCADE"))??'null') . "\x0A";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:155: characters 3-12
		return $rq;
	}

	/**
	 * @param string $fname
	 * 
	 * @return string
	 */
	public function removeFieldRequest ($fname) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:222: characters 3-60
		return "ALTER TABLE " . ($this->escape($this->name)??'null') . " DROP " . ($this->escape($fname)??'null');
	}

	/**
	 * @param string $old
	 * @param string $newname
	 * 
	 * @return string
	 */
	public function renameFieldRequest ($old, $newname) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:226: characters 3-36
		$ftype = ($this->hfields->data[$newname] ?? null);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:227: lines 227-228
		if ($ftype === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:228: characters 4-9
			throw new HxException("No field " . ($newname??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:229: characters 3-67
		$rq = "ALTER TABLE " . ($this->escape($this->name)??'null') . " CHANGE " . ($this->escape($old)??'null') . " ";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:230: characters 3-83
		return ($rq??'null') . ($this->escape($newname)??'null') . " " . ($this->fieldInfos(new HxAnon([
			"name" => $newname,
			"type" => $ftype,
		]))??'null');
	}

	/**
	 * @return string
	 */
	public function truncateRequest () {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:198: characters 3-40
		return "TRUNCATE TABLE " . ($this->escape($this->name)??'null');
	}

	/**
	 * @param string $fname
	 * 
	 * @return string
	 */
	public function updateFieldRequest ($fname) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:234: characters 3-34
		$ftype = ($this->hfields->data[$fname] ?? null);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:235: lines 235-236
		if ($ftype === null) {
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:236: characters 4-9
			throw new HxException("No field " . ($fname??'null'));
		}
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:237: characters 3-51
		$rq = "ALTER TABLE " . ($this->escape($this->name)??'null') . " MODIFY ";
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:238: characters 3-75
		return ($rq??'null') . ($this->escape($fname)??'null') . " " . ($this->fieldInfos(new HxAnon([
			"name" => $fname,
			"type" => $ftype,
		]))??'null');
	}

	/**
	 * @param object $o
	 * @param List_hx $fields
	 * 
	 * @return string
	 */
	public function updateFields ($o, $fields) {
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:277: characters 3-17
		$me = $this;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:278: characters 3-27
		$s = new \StringBuf();
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:279: characters 3-19
		$s->add("UPDATE ");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:280: characters 3-22
		$s->add($this->escape($this->name));
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:281: characters 3-17
		$s->add(" SET ");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:282: characters 3-20
		$first = true;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:283: characters 13-19
		$_g_head = $fields->h;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:283: lines 283-291
		while ($_g_head !== null) {
			$val = $_g_head->item;
			$_g_head = $_g_head->next;
			$f = $val;
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:284: lines 284-287
			if ($first) {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:285: characters 5-10
				$first = false;
			} else {
				#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:287: characters 5-16
				$s->add(", ");
			}
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:288: characters 4-25
			$s->add($this->escape($f->name));
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:289: characters 4-16
			$s->add(" = ");
			#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:290: characters 4-35
			Manager::$cnx->addValue($s, $f->value);
		}

		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:292: characters 3-19
		$s->add(" WHERE ");
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:293: characters 3-40
		$m = $this->manager;
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:294: characters 3-17
		$m->addKeys($s, $o);
		#/home/bubar/projects/spod/src/sys/db/admin/TableInfos.hx:295: characters 3-22
		return $s->b;
	}
}

Boot::registerClass(TableInfos::class, 'sys.db.admin.TableInfos');
