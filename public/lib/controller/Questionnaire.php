<?php
/**
 * Generated by Haxe 4.0.0-rc.1+1fdd3d5
 */

namespace controller;

use \db\Page as DbPage;
use \php\_Boot\HxAnon;
use \php\Boot;
use \db\Question;
use \db\Questionnaire as DbQuestionnaire;
use \sugoi\BaseController;
use \php\_Boot\HxException;
use \sugoi\form\Form;

class Questionnaire extends BaseController {

	/**
	 * @return void
	 */
	public function __construct () {
		#src/controller/Questionnaire.hx:10: characters 3-10
		parent::__construct();
	}

	/**
	 * @return void
	 */
	public function doDefault () {
		#src/controller/Questionnaire.hx:16: characters 3-55
		$this->view->questionnaires = DbQuestionnaire::$manager->all();
	}

	/**
	 * @param DbQuestionnaire $questionnaire
	 * 
	 * @return void
	 */
	public function doEdit ($questionnaire) {
		#src/controller/Questionnaire.hx:36: characters 9-57
		$f = Form::fromSpod($questionnaire);
		#src/controller/Questionnaire.hx:38: lines 38-43
		if ($f->isValid()) {
			#src/controller/Questionnaire.hx:39: characters 13-33
			$questionnaire->lock();
			#src/controller/Questionnaire.hx:40: characters 13-36
			$f->toSpod($questionnaire);
			#src/controller/Questionnaire.hx:41: characters 13-35
			$questionnaire->update();
			#src/controller/Questionnaire.hx:42: characters 13-18
			throw new HxException($this->Ok("/questionnaire", "Questionnaire mis à jour"));
		}
		#src/controller/Questionnaire.hx:45: characters 9-22
		$this->view->form = $f;
	}

	/**
	 * @return void
	 */
	public function doInsert () {
		#src/controller/Questionnaire.hx:50: characters 9-52
		$questionnaire = new DbQuestionnaire();
		#src/controller/Questionnaire.hx:51: characters 9-59
		$f = Form::fromSpod($questionnaire);
		#src/controller/Questionnaire.hx:52: lines 52-57
		if ($f->isValid()) {
			#src/controller/Questionnaire.hx:53: characters 13-36
			$f->toSpod($questionnaire);
			#src/controller/Questionnaire.hx:54: characters 13-35
			$questionnaire->insert();
			#src/controller/Questionnaire.hx:55: characters 13-18
			throw new HxException($this->Ok("/questionnaire", "Nouveau questionnaire créé"));
		}
		#src/controller/Questionnaire.hx:59: characters 9-22
		$this->view->form = $f;
	}

	/**
	 * @param DbQuestionnaire $questionnaire
	 * 
	 * @return void
	 */
	public function doView ($questionnaire) {
		#src/controller/Questionnaire.hx:23: lines 23-28
		if (($this->app->params->data["move"] ?? null) !== null) {
			#src/controller/Questionnaire.hx:24: characters 13-86
			$q = Question::$manager->unsafeGet(\Std::parseInt(($this->app->params->data["q"] ?? null)), false);
			#src/controller/Questionnaire.hx:25: characters 13-88
			$page = DbPage::$manager->unsafeGet(\Std::parseInt(($this->app->params->data["page"] ?? null)), false);
			#src/controller/Questionnaire.hx:26: characters 13-56
			$page->moveQuestion($q, ($this->app->params->data["move"] ?? null));
			#src/controller/Questionnaire.hx:27: characters 13-18
			throw new HxException($this->Ok("/questionnaire/view/" . ($questionnaire->id??'null'), "Question déplacée"));
		}
		#src/controller/Questionnaire.hx:30: characters 3-37
		$this->view->questionnaire = $questionnaire;
	}

	/**
	 * @internal
	 * @access private
	 */
	static public function __hx__init ()
	{
		static $called = false;
		if ($called) return;
		$called = true;


	}
}

Boot::registerClass(Questionnaire::class, 'controller.Questionnaire');
Boot::registerMeta(Questionnaire::class, new HxAnon([
	"obj" => new HxAnon(["dispatchConfig" => \Array_hx::wrap(["oy4:viewjy21:haxe.web.DispatchRule:3:1jR1:0:1jy18:haxe.web.MatchRule:7:2y16:db.Questionnairefy4:editjR1:3:1jR1:0:1jR2:7:2R3fy6:insertjR1:3:1jR1:1:1ahy4:filejR1:0:1jR2:3:0y7:defaultjR1:3:1jR1:1:1ahg"])]),
	"fields" => new HxAnon([
		"doDefault" => new HxAnon([
			"admin" => null,
			"tpl" => \Array_hx::wrap(["questionnaire/default.mtt"]),
		]),
		"doView" => new HxAnon([
			"admin" => null,
			"tpl" => \Array_hx::wrap(["questionnaire/view.mtt"]),
		]),
		"doEdit" => new HxAnon([
			"admin" => null,
			"tpl" => \Array_hx::wrap(["form.twig"]),
		]),
		"doInsert" => new HxAnon([
			"admin" => null,
			"tpl" => \Array_hx::wrap(["form.twig"]),
		]),
	]),
]));
Questionnaire::__hx__init();
